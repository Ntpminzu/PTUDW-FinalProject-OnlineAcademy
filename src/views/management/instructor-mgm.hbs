<<<<<<< HEAD
{{#section "styles" append=true}}
<link rel="stylesheet" href="/course-form.css" />
<script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
{{/section}}

<main class="main-content">
    <div class="container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title" id="welcomeTitle">
                Há»‡ thá»‘ng quáº£n lÃ½ khÃ³a há»c &amp; giáº£ng viÃªn
            </h1>
            <p class="welcome-text" id="welcomeText">
                ChÃ o má»«ng Ä‘áº¿n vá»›i há»‡ thá»‘ng quáº£n lÃ½ khÃ³a há»c vÃ  giáº£ng viÃªn chuyÃªn
                nghiá»‡p
            </p>
        </div>
        <!-- Instructor Management Section -->
        <section id="instructorsSection" class="section active">
            <h2 class="section-title">ğŸ‘¨â€ğŸ« Quáº£n lÃ½ giáº£ng viÃªn</h2>
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchInstructorTab('list')">
                    ğŸ‘¥ Danh sÃ¡ch giáº£ng viÃªn
                </button>
                <button class="tab-btn" onclick="switchInstructorTab('add')">
                    â• ThÃªm giáº£ng viÃªn
                </button>
                <button class="tab-btn" onclick="switchInstructorTab('stats')">
                    ğŸ“Š Thá»‘ng kÃª
                </button>
            </div>
            <!-- Instructor List Tab -->
            <div id="instructorListTab" class="tab-content active">
                <div class="search-filter-bar">
                    <input type="text" class="search-input" id="instructorSearchInput"
                        placeholder="ğŸ” TÃ¬m kiáº¿m giáº£ng viÃªn..." onkeyup="filterInstructors()" />
                    <select class="form-select" id="experienceFilter" onchange="filterInstructors()"
                        style="width: auto">
                        <option value="">Táº¥t cáº£ kinh nghiá»‡m</option>
                        <option value="1-3">1-3 nÄƒm</option>
                        <option value="4-7">4-7 nÄƒm</option>
                        <option value="8+">8+ nÄƒm</option>
                    </select>
                    <button class="btn btn-primary" onclick="showAddInstructorModal()">
                        â• ThÃªm giáº£ng viÃªn
                    </button>
                </div>
                <div id="instructorsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Äang táº£i danh sÃ¡ch giáº£ng viÃªn...</p>
                    </div>
                </div>
            </div>
            <!-- Add Instructor Tab -->
            <div id="instructorAddTab" class="tab-content">
                <div class="form-container">
                    <h3 style="
            color: var(--accent-gold);
            margin-bottom: 25px;
            text-align: center;
        ">
                        â• ThÃªm giáº£ng viÃªn má»›i
                    </h3>
                    <form id="quickInstructorForm" onsubmit="quickAddInstructor(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickInstructorName">Há» tÃªn *</label>
                                <input type="text" class="form-input" id="quickInstructorName" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickInstructorEmail">Email *</label>
                                <input type="email" class="form-input" id="quickInstructorEmail" required />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickExperience">Kinh nghiá»‡m (nÄƒm) *</label>
                                <input type="number" class="form-input" id="quickExperience" min="0" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickAvatar">Avatar (emoji) *</label>
                                <input type="text" class="form-input" id="quickAvatar" maxlength="2" required
                                    placeholder="ğŸ‘¨â€ğŸ«" />
                            </div>
                        </div>
                        <div class="form-row full">
                            <div class="form-group">
                                <label class="form-label" for="quickBio">Giá»›i thiá»‡u báº£n thÃ¢n *</label>
                                <textarea class="form-textarea" id="quickBio" rows="4" required
                                    placeholder="Chia sáº» vá» kinh nghiá»‡m, chuyÃªn mÃ´n vÃ  passion..."></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickGithub">GitHub (tÃ¹y chá»n)</label>
                                <input type="url" class="form-input" id="quickGithub"
                                    placeholder="https://github.com/username" />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickLinkedin">LinkedIn (tÃ¹y chá»n)</label>
                                <input type="url" class="form-input" id="quickLinkedin"
                                    placeholder="https://linkedin.com/in/username" />
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 30px">
                            <button type="submit" class="btn btn-primary" style="margin-right: 15px">
                                ğŸ’¾ LÆ°u giáº£ng viÃªn
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetInstructorForm()">
                                ğŸ”„ LÃ m má»›i
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Instructor Stats Tab -->
            <div id="instructorStatsTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¨â€ğŸ«</div>
                        <div class="stat-number" id="totalInstructors">0</div>
                        <div class="stat-label">Tá»•ng giáº£ng viÃªn</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â­</div>
                        <div class="stat-number" id="avgInstructorRating">0</div>
                        <div class="stat-label">ÄÃ¡nh giÃ¡ TB</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“š</div>
                        <div class="stat-number" id="avgCoursesPerInstructor">0</div>
                        <div class="stat-label">KhÃ³a há»c TB/GV</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-number" id="avgExperience">0</div>
                        <div class="stat-label">Kinh nghiá»‡m TB</div>
                    </div>
                </div>
                <div id="instructorStatsDetails">
                    <!-- Detailed instructor statistics will be loaded here -->
                </div>
            </div>
        </section>
    </div>
</main>
<script>
    // Global variables
    let allCourses = [];
    let allInstructors = [];
    let filteredCourses = [];
    let filteredInstructors = [];

    // Default configuration
    const defaultConfig = {
        system_title: "ğŸ“š Course & Instructor Management",
        welcome_text:
            "ChÃ o má»«ng Ä‘áº¿n vá»›i há»‡ thá»‘ng quáº£n lÃ½ khÃ³a há»c vÃ  giáº£ng viÃªn chuyÃªn nghiá»‡p",
    };

    // Subcategory mapping
    const subcategoryMap = {
        IT: [
            "Láº­p trÃ¬nh Web",
            "Láº­p trÃ¬nh thiáº¿t bá»‹ di Ä‘á»™ng",
            "Data Science",
            "DevOps",
            "Cybersecurity",
        ],
        Design: [
            "UI/UX Design",
            "Graphic Design",
            "Web Design",
            "Motion Graphics",
        ],
        Business: ["Quáº£n lÃ½ dá»± Ã¡n", "Khá»Ÿi nghiá»‡p", "TÃ i chÃ­nh", "NhÃ¢n sá»±"],
        Marketing: [
            "Digital Marketing",
            "Content Marketing",
            "SEO/SEM",
            "Social Media",
        ],
    };

    // Data handler for SDK
    const dataHandler = {
        onDataChanged(data) {
            allCourses = data.filter((item) => item.type === "course");
            allInstructors = data.filter((item) => item.type === "instructor");
            updateUI();
        },
    };

    // Initialize SDK and app
    async function initializeApp() {
        if (window.dataSdk) {
            const result = await window.dataSdk.init(dataHandler);
            if (result.isOk) {
                await seedInitialData();
            } else {
                console.error("Failed to initialize data SDK");
            }
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues,
            });
        }

        render(defaultConfig);
    }

    // Render function for Element SDK
    async function render(config) {
        const systemTitle = config.system_title || defaultConfig.system_title;
        const welcomeText = config.welcome_text || defaultConfig.welcome_text;

        document.getElementById("systemTitle").textContent = systemTitle;
        document.getElementById("welcomeText").textContent = welcomeText;
    }

    // Capabilities mapping
    function mapToCapabilities(config) {
        return {
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined,
        };
    }

    // Edit panel values mapping
    function mapToEditPanelValues(config) {
        return new Map([
            ["system_title", config.system_title || defaultConfig.system_title],
            ["welcome_text", config.welcome_text || defaultConfig.welcome_text],
        ]);
    }

    // Seed initial data
    async function seedInitialData() {
        if (allInstructors.length > 0) return; // Data already exists

        // Sample instructors
        const sampleInstructors = [
            {
                id: "instructor_1",
                type: "instructor",
                user_name: "Nguyá»…n VÄƒn Minh",
                user_email: "minh.instructor@example.com",
                bio: "Senior Python Developer vá»›i 8+ nÄƒm kinh nghiá»‡m trong phÃ¡t triá»ƒn web vÃ  á»©ng dá»¥ng enterprise. ÄÃ£ lÃ m viá»‡c táº¡i cÃ¡c cÃ´ng ty cÃ´ng nghá»‡ hÃ ng Ä‘áº§u.",
                experience: "8",
                avatar: "ğŸ",
                social_links: JSON.stringify({
                    github: "https://github.com/minhpython",
                    linkedin: "https://linkedin.com/in/minhpython",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_2",
                type: "instructor",
                user_name: "Tráº§n Thá»‹ Lan",
                user_email: "lan.instructor@example.com",
                bio: "Frontend Architect vá»›i chuyÃªn mÃ´n sÃ¢u vá» React.js vÃ  cÃ¡c cÃ´ng nghá»‡ frontend hiá»‡n Ä‘áº¡i. CÃ³ kinh nghiá»‡m mentoring team.",
                experience: "6",
                avatar: "âš¡",
                social_links: JSON.stringify({
                    github: "https://github.com/lanreact",
                    linkedin: "https://linkedin.com/in/lanreact",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_3",
                type: "instructor",
                user_name: "LÃª VÄƒn Äá»©c",
                user_email: "duc.instructor@example.com",
                bio: "Lead UX Designer vá»›i portfolio Ä‘a dáº¡ng tá»« startup Ä‘áº¿n enterprise. ChuyÃªn gia trong nghiÃªn cá»©u ngÆ°á»i dÃ¹ng vÃ  thiáº¿t káº¿ tráº£i nghiá»‡m.",
                experience: "7",
                avatar: "ğŸ¨",
                social_links: JSON.stringify({
                    behance: "https://behance.net/ducux",
                    linkedin: "https://linkedin.com/in/ducux",
                }),
                created_at: new Date().toISOString(),
            },
        ];

        // Sample courses
        const sampleCourses = [
            {
                id: "course_1",
                type: "course",
                title: "Advanced Python Programming",
                description:
                    "NÃ¢ng cao ká»¹ nÄƒng láº­p trÃ¬nh Python vá»›i cÃ¡c ká»¹ thuáº­t advanced vÃ  best practices tá»« cÃ¡c chuyÃªn gia hÃ ng Ä‘áº§u trong ngÃ nh.",
                category: "IT",
                subcategory: "Láº­p trÃ¬nh Web",
                instructor: "Nguyá»…n VÄƒn Minh",
                instructor_id: "instructor_1",
                rating: 4.9,
                reviews: 1234,
                students: 5678,
                price: 1299000,
                discount_price: 999000,
                image: "ğŸ",
                status: "completed",
                chapters: JSON.stringify([
                    "Giá»›i thiá»‡u Python Advanced",
                    "Object-Oriented Programming",
                    "Decorators vÃ  Generators",
                    "Async Programming",
                    "Testing vÃ  Debugging",
                ]),
                requirements:
                    "Kiáº¿n thá»©c cÆ¡ báº£n vá» Python\nHiá»ƒu vá» láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng",
                what_you_learn:
                    "Náº¯m vá»¯ng cÃ¡c ká»¹ thuáº­t Python nÃ¢ng cao\nXÃ¢y dá»±ng á»©ng dá»¥ng web vá»›i Django/Flask\nTá»‘i Æ°u hÃ³a hiá»‡u suáº¥t code\nViáº¿t test cases chuyÃªn nghiá»‡p",
                target_audience:
                    "Láº­p trÃ¬nh viÃªn Python cÃ³ kinh nghiá»‡m\nSinh viÃªn IT muá»‘n nÃ¢ng cao ká»¹ nÄƒng",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_2",
                type: "course",
                title: "React.js Mastery",
                description:
                    "Trá»Ÿ thÃ nh chuyÃªn gia React.js vá»›i khÃ³a há»c toÃ n diá»‡n tá»« cÆ¡ báº£n Ä‘áº¿n nÃ¢ng cao, bao gá»“m hooks, context, vÃ  cÃ¡c pattern hiá»‡n Ä‘áº¡i.",
                category: "IT",
                subcategory: "Láº­p trÃ¬nh Web",
                instructor: "Tráº§n Thá»‹ Lan",
                instructor_id: "instructor_2",
                rating: 4.8,
                reviews: 987,
                students: 3456,
                price: 1599000,
                discount_price: 1199000,
                image: "âš¡",
                status: "incomplete",
                chapters: JSON.stringify([
                    "React Fundamentals",
                    "Components vÃ  Props",
                    "State Management",
                    "React Hooks",
                    "Advanced Patterns",
                ]),
                requirements: "Kiáº¿n thá»©c HTML, CSS, JavaScript\nHiá»ƒu vá» ES6+",
                what_you_learn:
                    "XÃ¢y dá»±ng á»©ng dá»¥ng React tá»« Ä‘áº§u\nQuáº£n lÃ½ state hiá»‡u quáº£\nSá»­ dá»¥ng hooks vÃ  context",
                target_audience: "Frontend developers\nSinh viÃªn muá»‘n há»c React",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_3",
                type: "course",
                title: "UI/UX Design Complete",
                description:
                    "KhÃ³a há»c thiáº¿t káº¿ UI/UX hoÃ n chá»‰nh vá»›i cÃ¡c dá»± Ã¡n thá»±c táº¿ vÃ  portfolio chuyÃªn nghiá»‡p, tá»« research Ä‘áº¿n prototype.",
                category: "Design",
                subcategory: "UI/UX Design",
                instructor: "LÃª VÄƒn Äá»©c",
                instructor_id: "instructor_3",
                rating: 4.7,
                reviews: 756,
                students: 2345,
                price: 1799000,
                discount_price: 1399000,
                image: "ğŸ¨",
                status: "completed",
                chapters: JSON.stringify([
                    "Design Thinking",
                    "User Research",
                    "Wireframing",
                    "Prototyping",
                    "Visual Design",
                ]),
                requirements:
                    "KhÃ´ng cáº§n kinh nghiá»‡m trÆ°á»›c\nMÃ¡y tÃ­nh cÃ³ thá»ƒ cháº¡y Figma",
                what_you_learn:
                    "Quy trÃ¬nh thiáº¿t káº¿ UX hoÃ n chá»‰nh\nSá»­ dá»¥ng Figma chuyÃªn nghiá»‡p\nTáº¡o prototype tÆ°Æ¡ng tÃ¡c",
                target_audience:
                    "NgÆ°á»i má»›i báº¯t Ä‘áº§u vá»›i UX/UI\nGraphic designer muá»‘n chuyá»ƒn ngÃ nh",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
        ];

        // Create instructors first
        for (const instructor of sampleInstructors) {
            const result = await window.dataSdk.create(instructor);
            if (!result.isOk) {
                console.error("Failed to create instructor:", instructor.user_name);
            }
        }

        // Then create courses
        for (const course of sampleCourses) {
            const result = await window.dataSdk.create(course);
            if (!result.isOk) {
                console.error("Failed to create course:", course.title);
            }
        }
    }

    // Update UI based on data
    function updateUI() {
        filteredCourses = [...allCourses];
        filteredInstructors = [...allInstructors];

        updateCoursesList();
        updateInstructorsList();
        updateCourseStats();
        updateInstructorStats();
        loadInstructorOptions();
    }

    // Section navigation
    function showSection(sectionName) {
        // Update nav links
        document
            .querySelectorAll(".nav-link")
            .forEach((link) => link.classList.remove("active"));
        event.target.classList.add("active");

        // Hide all sections
        document
            .querySelectorAll(".section")
            .forEach((section) => section.classList.remove("active"));

        // Show selected section
        document
            .getElementById(sectionName + "Section")
            .classList.add("active");
    }

    // Course Management Functions
    function switchCourseTab(tabName) {
        document
            .querySelectorAll("#coursesSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#coursesSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "course" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateCourseStats();
        }
    }

    function updateCoursesList() {
        const container = document.getElementById("coursesList");

        if (filteredCourses.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>ğŸ“š ChÆ°a cÃ³ khÃ³a há»c nÃ o</h3>
                    <p>HÃ£y thÃªm khÃ³a há»c Ä‘áº§u tiÃªn</p>
                    <button class="btn btn-primary" onclick="switchCourseTab('add')">â• ThÃªm khÃ³a há»c</button>
                </div>
            `;
            return;
        }

        const coursesHtml = filteredCourses
            .map(
                (course) => `
            <div class="card">
                <div class="card-header">
                    <div class="card-avatar">${course.image}</div>
                    <div class="card-info">
                        <h3>${course.title}</h3>
                        <p>${course.category} â€¢ ${course.subcategory}</p>
                    </div>
                </div>
                <div class="card-content">
                    <p>${course.description.substring(0, 120)}...</p>
                </div>
                <div class="card-meta">
                    <div class="meta-badge">ğŸ‘¨â€ğŸ« ${course.instructor}</div>
                    <div class="meta-badge">â­ ${course.rating}</div>
                    <div class="meta-badge">ğŸ‘¥ ${course.students}</div>
                    <span class="status-badge status-${course.status}">
                        ${course.status === "completed"
                        ? "HoÃ n thÃ nh"
                        : course.status === "incomplete"
                            ? "ChÆ°a hoÃ n thÃ nh"
                            : "Báº£n nhÃ¡p"
                    }
                    </span>
                </div>
                <div class="price-display">
                    <span class="price-current">${formatPrice(
                        course.discount_price || course.price
                    )}</span>
                    ${course.discount_price
                        ? `<span class="price-original">${formatPrice(
                            course.price
                        )}</span>`
                        : ""
                    }
                </div>
                <div class="card-actions">
                    <button class="btn btn-primary btn-sm" onclick="viewCourseDetail('${course.id
                    }')">ğŸ‘ï¸ Xem chi tiáº¿t</button>
                    <button class="btn btn-secondary btn-sm" onclick="editCourse('${course.id
                    }')">âœï¸ Sá»­a</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteCourseConfirm('${course.id
                    }')">ğŸ—‘ï¸ XÃ³a</button>
                </div>
            </div>
        `
            )
            .join("");

        container.innerHTML = `<div class="card-grid">${coursesHtml}</div>`;
    }

    function filterCourses() {
        const searchTerm = document
            .getElementById("courseSearchInput")
            .value.toLowerCase();
        const categoryFilter = document.getElementById("categoryFilter").value;
        const statusFilter = document.getElementById("statusFilter").value;

        filteredCourses = allCourses.filter((course) => {
            const matchesSearch =
                !searchTerm ||
                course.title.toLowerCase().includes(searchTerm) ||
                course.description.toLowerCase().includes(searchTerm) ||
                course.instructor.toLowerCase().includes(searchTerm);

            const matchesCategory =
                !categoryFilter || course.category === categoryFilter;
            const matchesStatus = !statusFilter || course.status === statusFilter;

            return matchesSearch && matchesCategory && matchesStatus;
        });

        updateCoursesList();
    }

    function updateQuickSubcategories() {
        const category = document.getElementById("quickCategory").value;
        const subcategorySelect = document.getElementById("quickSubcategory");

        subcategorySelect.innerHTML =
            '<option value="">Chá»n chuyÃªn ngÃ nh</option>';

        if (category && subcategoryMap[category]) {
            subcategoryMap[category].forEach((sub) => {
                const option = document.createElement("option");
                option.value = sub;
                option.textContent = sub;
                subcategorySelect.appendChild(option);
            });
        }
    }

    function loadInstructorOptions() {
        const select = document.getElementById("quickInstructor");
        select.innerHTML = '<option value="">Chá»n giáº£ng viÃªn</option>';

        allInstructors.forEach((instructor) => {
            const option = document.createElement("option");
            option.value = instructor.id;
            option.textContent = `${instructor.avatar} ${instructor.user_name}`;
            select.appendChild(option);
        });
    }

    async function quickAddCourse(event) {
        event.preventDefault();

        if (allCourses.length >= 999) {
            showToast("ÄÃ£ Ä‘áº¡t giá»›i háº¡n tá»‘i Ä‘a 999 khÃ³a há»c!", "error");
            return;
        }

        const instructorId = document.getElementById("quickInstructor").value;
        const instructor = allInstructors.find((i) => i.id === instructorId);

        if (!instructor) {
            showToast("Vui lÃ²ng chá»n giáº£ng viÃªn!", "error");
            return;
        }

        const newCourse = {
            id: "course_" + Date.now(),
            type: "course",
            title: document.getElementById("quickTitle").value,
            description: document.getElementById("quickDescription").value,
            category: document.getElementById("quickCategory").value,
            subcategory: document.getElementById("quickSubcategory").value,
            instructor: instructor.user_name,
            instructor_id: instructorId,
            rating: 0,
            reviews: 0,
            students: 0,
            price: parseInt(document.getElementById("quickPrice").value),
            discount_price: null,
            image: document.getElementById("quickImage").value || "ğŸ“š",
            status: "draft",
            chapters: JSON.stringify(["ChÆ°Æ¡ng 1: Giá»›i thiá»‡u"]),
            requirements: "",
            what_you_learn: "",
            target_audience: "",
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newCourse);
        if (result.isOk) {
            showToast("Táº¡o khÃ³a há»c thÃ nh cÃ´ng!", "success");
            resetQuickForm();
            switchCourseTab("list");
        } else {
            showToast("Táº¡o khÃ³a há»c tháº¥t báº¡i!", "error");
        }
    }

    function resetQuickForm() {
        document.getElementById("quickCourseForm").reset();
        document.getElementById("quickSubcategory").innerHTML =
            '<option value="">Chá»n chuyÃªn ngÃ nh</option>';
    }

    function updateCourseStats() {
        const totalCourses = allCourses.length;
        const completedCourses = allCourses.filter(
            (c) => c.status === "completed"
        ).length;
        const incompleteCourses = allCourses.filter(
            (c) => c.status === "incomplete"
        ).length;
        const totalStudents = allCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );

        document.getElementById("totalCourses").textContent = totalCourses;
        document.getElementById("completedCourses").textContent =
            completedCourses;
        document.getElementById("incompleteCourses").textContent =
            incompleteCourses;
        document.getElementById("totalStudents").textContent = totalStudents;

        // Category statistics
        const categoryStats = {};
        allCourses.forEach((course) => {
            if (!categoryStats[course.category]) {
                categoryStats[course.category] = {
                    total: 0,
                    completed: 0,
                    students: 0,
                };
            }
            categoryStats[course.category].total++;
            if (course.status === "completed") {
                categoryStats[course.category].completed++;
            }
            categoryStats[course.category].students += course.students;
        });

        const categoryStatsHtml = Object.entries(categoryStats)
            .map(
                ([category, stats]) => `
            <div class="category-stats">
                <h4>ğŸ“Š ${category}</h4>
                <div class="category-item">
                    <span>Tá»•ng khÃ³a há»c:</span>
                    <span>${stats.total}</span>
                </div>
                <div class="category-item">
                    <span>ÄÃ£ hoÃ n thÃ nh:</span>
                    <span>${stats.completed}</span>
                </div>
                <div class="category-item">
                    <span>Tá»•ng há»c viÃªn:</span>
                    <span>${stats.students}</span>
                </div>
            </div>
        `
            )
            .join("");

        document.getElementById("categoryStatsContainer").innerHTML =
            categoryStatsHtml;
    }

    // Instructor Management Functions
    function switchInstructorTab(tabName) {
        document
            .querySelectorAll("#instructorsSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#instructorsSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "instructor" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateInstructorStats();
        }
    }

    function updateInstructorsList() {
        const container = document.getElementById("instructorsList");

        if (filteredInstructors.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>ğŸ‘¨â€ğŸ« ChÆ°a cÃ³ giáº£ng viÃªn nÃ o</h3>
                    <p>HÃ£y thÃªm giáº£ng viÃªn Ä‘áº§u tiÃªn</p>
                    <button class="btn btn-primary" onclick="switchInstructorTab('add')">â• ThÃªm giáº£ng viÃªn</button>
                </div>
            `;
            return;
        }

        const instructorsHtml = filteredInstructors
            .map((instructor) => {
                const instructorCourses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = instructorCourses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    instructorCourses.length > 0
                        ? (
                            instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                            instructorCourses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-avatar">${instructor.avatar}</div>
                        <div class="card-info">
                            <h3>${instructor.user_name}</h3>
                            <p>ğŸ“§ ${instructor.user_email}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <p>${instructor.bio.substring(0, 120)}...</p>
                    </div>
                    <div class="card-meta">
                        <div class="meta-badge">ğŸ¯ ${instructor.experience
                    }+ nÄƒm</div>
                        <div class="meta-badge">ğŸ“š ${instructorCourses.length
                    } khÃ³a há»c</div>
                        <div class="meta-badge">ğŸ‘¥ ${totalStudents} há»c viÃªn</div>
                        <div class="meta-badge">â­ ${avgRating}</div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary btn-sm" onclick="viewInstructorDetail('${instructor.id
                    }')">ğŸ‘ï¸ Xem chi tiáº¿t</button>
                        <button class="btn btn-secondary btn-sm" onclick="editInstructor('${instructor.id
                    }')">âœï¸ Sá»­a</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteInstructorConfirm('${instructor.id
                    }')">ğŸ—‘ï¸ XÃ³a</button>
                    </div>
                </div>
            `;
            })
            .join("");

        container.innerHTML = `<div class="card-grid">${instructorsHtml}</div>`;
    }

    function filterInstructors() {
        const searchTerm = document
            .getElementById("instructorSearchInput")
            .value.toLowerCase();
        const experienceFilter =
            document.getElementById("experienceFilter").value;

        filteredInstructors = allInstructors.filter((instructor) => {
            const matchesSearch =
                !searchTerm ||
                instructor.user_name.toLowerCase().includes(searchTerm) ||
                instructor.user_email.toLowerCase().includes(searchTerm) ||
                instructor.bio.toLowerCase().includes(searchTerm);

            let matchesExperience = true;
            if (experienceFilter) {
                const exp = parseInt(instructor.experience);
                switch (experienceFilter) {
                    case "1-3":
                        matchesExperience = exp >= 1 && exp <= 3;
                        break;
                    case "4-7":
                        matchesExperience = exp >= 4 && exp <= 7;
                        break;
                    case "8+":
                        matchesExperience = exp >= 8;
                        break;
                }
            }

            return matchesSearch && matchesExperience;
        });

        updateInstructorsList();
    }

    async function quickAddInstructor(event) {
        event.preventDefault();

        if (allInstructors.length >= 999) {
            showToast("ÄÃ£ Ä‘áº¡t giá»›i háº¡n tá»‘i Ä‘a 999 giáº£ng viÃªn!", "error");
            return;
        }

        const email = document.getElementById("quickInstructorEmail").value;
        const existingInstructor = allInstructors.find(
            (i) => i.user_email === email
        );

        if (existingInstructor) {
            showToast("Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng!", "error");
            return;
        }

        const socialLinks = {
            github: document.getElementById("quickGithub").value,
            linkedin: document.getElementById("quickLinkedin").value,
        };

        const newInstructor = {
            id: "instructor_" + Date.now(),
            type: "instructor",
            user_name: document.getElementById("quickInstructorName").value,
            user_email: email,
            bio: document.getElementById("quickBio").value,
            experience: document.getElementById("quickExperience").value,
            avatar: document.getElementById("quickAvatar").value,
            social_links: JSON.stringify(socialLinks),
            created_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newInstructor);
        if (result.isOk) {
            showToast("ThÃªm giáº£ng viÃªn thÃ nh cÃ´ng!", "success");
            resetInstructorForm();
            switchInstructorTab("list");
        } else {
            showToast("ThÃªm giáº£ng viÃªn tháº¥t báº¡i!", "error");
        }
    }

    function resetInstructorForm() {
        document.getElementById("quickInstructorForm").reset();
    }

    function updateInstructorStats() {
        const totalInstructors = allInstructors.length;
        const avgRating =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce((sum, instructor) => {
                        const courses = allCourses.filter(
                            (c) => c.instructor_id === instructor.id
                        );
                        const instructorAvgRating =
                            courses.length > 0
                                ? courses.reduce((sum, c) => sum + c.rating, 0) /
                                courses.length
                                : 0;
                        return sum + instructorAvgRating;
                    }, 0) / allInstructors.length
                ).toFixed(1)
                : 0;

        const avgCoursesPerInstructor =
            totalInstructors > 0
                ? (allCourses.length / totalInstructors).toFixed(1)
                : 0;

        const avgExperience =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce(
                        (sum, i) => sum + parseInt(i.experience),
                        0
                    ) / allInstructors.length
                ).toFixed(1)
                : 0;

        document.getElementById("totalInstructors").textContent =
            totalInstructors;
        document.getElementById("avgInstructorRating").textContent = avgRating;
        document.getElementById("avgCoursesPerInstructor").textContent =
            avgCoursesPerInstructor;
        document.getElementById("avgExperience").textContent = avgExperience;

        // Detailed instructor statistics
        const instructorStatsHtml = allInstructors
            .map((instructor) => {
                const courses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = courses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    courses.length > 0
                        ? (
                            courses.reduce((sum, c) => sum + c.rating, 0) /
                            courses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="category-stats">
                    <h4>${instructor.avatar} ${instructor.user_name}</h4>
                    <div class="category-item">
                        <span>Sá»‘ khÃ³a há»c:</span>
                        <span>${courses.length}</span>
                    </div>
                    <div class="category-item">
                        <span>Tá»•ng há»c viÃªn:</span>
                        <span>${totalStudents}</span>
                    </div>
                    <div class="category-item">
                        <span>ÄÃ¡nh giÃ¡ trung bÃ¬nh:</span>
                        <span>${avgRating}</span>
                    </div>
                    <div class="category-item">
                        <span>Kinh nghiá»‡m:</span>
                        <span>${instructor.experience} nÄƒm</span>
                    </div>
                </div>
            `;
            })
            .join("");

        document.getElementById("instructorStatsDetails").innerHTML =
            instructorStatsHtml;
    }

    // Detail view functions
    function viewCourseDetail(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        const instructor = allInstructors.find(
            (i) => i.id === course.instructor_id
        );
        const chapters = JSON.parse(course.chapters || "[]");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin-right: 20px;">
                        ${course.image}
                    </div>
                    <div>
                        <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${course.title
            }</h2>
                        <p style="color: var(--light-silver); margin: 0;">${course.category
            } â€¢ ${course.subcategory}</p>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“‹ MÃ´ táº£</h4>
                    <p style="color: white; line-height: 1.6;">${course.description
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ’° ThÃ´ng tin giÃ¡</h4>
                        <div style="color: white;">
                            <div>GiÃ¡ gá»‘c: ${formatPrice(course.price)}</div>
                            ${course.discount_price
                ? `<div>GiÃ¡ khuyáº¿n mÃ£i: ${formatPrice(
                    course.discount_price
                )}</div>`
                : ""
            }
                        </div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“Š Thá»‘ng kÃª</h4>
                        <div style="color: white;">
                            <div>â­ ${course.rating} (${course.reviews
            } Ä‘Ã¡nh giÃ¡)</div>
                            <div>ğŸ‘¥ ${course.students} há»c viÃªn</div>
                            <div>ğŸ“… ${new Date(
                course.created_at
            ).toLocaleDateString("vi-VN")}</div>
                        </div>
                    </div>
                </div>

                ${instructor
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ‘¨â€ğŸ« Giáº£ng viÃªn</h4>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-right: 15px;">
                                ${instructor.avatar}
                            </div>
                            <div>
                                <div style="color: white; font-weight: bold;">${instructor.user_name}</div>
                                <div style="color: var(--light-silver);">${instructor.experience}+ nÄƒm kinh nghiá»‡m</div>
                            </div>
                        </div>
                    </div>
                `
                : ""
            }

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“š ChÆ°Æ¡ng trÃ¬nh há»c</h4>
                    <div>
                        ${chapters
                .map(
                    (chapter, index) => `
                            <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; color: white;">
                                ChÆ°Æ¡ng ${index + 1}: ${chapter}
                            </div>
                        `
                )
                .join("")}
                    </div>
                </div>
            </div>
        `;

        document.getElementById("courseModalContent").innerHTML = detailHtml;
        document.getElementById("courseModalTitle").textContent = course.title;
        document.getElementById("courseModal").classList.add("show");
    }

    function viewInstructorDetail(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        const totalStudents = instructorCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );
        const avgRating =
            instructorCourses.length > 0
                ? (
                    instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                    instructorCourses.length
                ).toFixed(1)
                : 0;

        const socialLinks = JSON.parse(instructor.social_links || "{}");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 120px; height: 120px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px;">
                        ${instructor.avatar}
                    </div>
                    <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${instructor.user_name
            }</h2>
                    <p style="color: var(--light-silver); margin: 0;">ğŸ“§ ${instructor.user_email
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructorCourses.length
            }</div>
                        <div style="color: white; font-size: 0.9rem;">KhÃ³a há»c</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${totalStudents}</div>
                        <div style="color: white; font-size: 0.9rem;">Há»c viÃªn</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${avgRating}</div>
                        <div style="color: white; font-size: 0.9rem;">ÄÃ¡nh giÃ¡ TB</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructor.experience
            }</div>
                        <div style="color: white; font-size: 0.9rem;">NÄƒm KN</div>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“ Giá»›i thiá»‡u</h4>
                    <p style="color: white; line-height: 1.6;">${instructor.bio
            }</p>
                </div>

                ${Object.keys(socialLinks).length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ”— LiÃªn káº¿t</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            ${socialLinks.github
                    ? `<a href="${socialLinks.github}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">ğŸ™ GitHub</a>`
                    : ""
                }
                            ${socialLinks.linkedin
                    ? `<a href="${socialLinks.linkedin}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">ğŸ’¼ LinkedIn</a>`
                    : ""
                }
                            ${socialLinks.behance
                    ? `<a href="${socialLinks.behance}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">ğŸ¨ Behance</a>`
                    : ""
                }
                        </div>
                    </div>
                `
                : ""
            }

                ${instructorCourses.length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“š KhÃ³a há»c giáº£ng dáº¡y</h4>
                        <div>
                            ${instructorCourses
                    .map(
                        (course) => `
                                <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: var(--accent-gold); font-weight: bold;">${course.title}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.category} â€¢ ${course.subcategory}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: white;">â­ ${course.rating}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.students} há»c viÃªn</div>
                                    </div>
                                </div>
                            `
                    )
                    .join("")}
                        </div>
                    </div>
                `
                : ""
            }
            </div>
        `;

        document.getElementById("instructorModalContent").innerHTML =
            detailHtml;
        document.getElementById("instructorModalTitle").textContent =
            instructor.user_name;
        document.getElementById("instructorModal").classList.add("show");
    }

    // Delete confirmation functions
    async function deleteCourseConfirm(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        if (confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a khÃ³a há»c "${course.title}"?`)) {
            const result = await window.dataSdk.delete(course);
            if (result.isOk) {
                showToast("XÃ³a khÃ³a há»c thÃ nh cÃ´ng!", "success");
            } else {
                showToast("XÃ³a khÃ³a há»c tháº¥t báº¡i!", "error");
            }
        }
    }

    async function deleteInstructorConfirm(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        if (instructorCourses.length > 0) {
            showToast("KhÃ´ng thá»ƒ xÃ³a giáº£ng viÃªn Ä‘ang cÃ³ khÃ³a há»c!", "error");
            return;
        }

        if (
            confirm(
                `Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a giáº£ng viÃªn "${instructor.user_name}"?`
            )
        ) {
            const result = await window.dataSdk.delete(instructor);
            if (result.isOk) {
                showToast("XÃ³a giáº£ng viÃªn thÃ nh cÃ´ng!", "success");
            } else {
                showToast("XÃ³a giáº£ng viÃªn tháº¥t báº¡i!", "error");
            }
        }
    }

    // Modal functions
    function closeCourseModal() {
        document.getElementById("courseModal").classList.remove("show");
    }

    function closeInstructorModal() {
        document.getElementById("instructorModal").classList.remove("show");
    }

    // Utility functions
    function formatPrice(price) {
        return new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
        }).format(price);
    }

    function showToast(message, type = "info") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => {
            toast.classList.add("show");
        }, 100);

        setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    // Initialize app when page loads
    document.addEventListener("DOMContentLoaded", initializeApp);
</script>
<script>
    (function () {
        function c() {
            var b = a.contentDocument || a.contentWindow.document;
            if (b) {
                var d = b.createElement("script");
                d.innerHTML =
                    "window.__CF$cv$params={r:'9929e89230c5fd8b',t:'MTc2MTE0NTY5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
                b.getElementsByTagName("head")[0].appendChild(d);
            }
        }
        if (document.body) {
            var a = document.createElement("iframe");
            a.height = 1;
            a.width = 1;
            a.style.position = "absolute";
            a.style.top = 0;
            a.style.left = 0;
            a.style.border = "none";
            a.style.visibility = "hidden";
            document.body.appendChild(a);
            if ("loading" !== document.readyState) c();
            else if (window.addEventListener)
                document.addEventListener("DOMContentLoaded", c);
            else {
                var e = document.onreadystatechange || function () { };
                document.onreadystatechange = function (b) {
                    e(b);
                    "loading" !== document.readyState &&
                        ((document.onreadystatechange = e), c());
                };
            }
        }
    })();
=======
{{#section "styles" append=true}}
<link rel="stylesheet" href="/course-form.css" />
<script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
{{/section}}

<main class="main-content">
    <div class="container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title" id="welcomeTitle">
                Há»‡ thá»‘ng quáº£n lÃ½ khÃ³a há»c &amp; giáº£ng viÃªn
            </h1>
            <p class="welcome-text" id="welcomeText">
                ChÃ o má»«ng Ä‘áº¿n vá»›i há»‡ thá»‘ng quáº£n lÃ½ khÃ³a há»c vÃ  giáº£ng viÃªn chuyÃªn
                nghiá»‡p
            </p>
        </div>
        <!-- Instructor Management Section -->
        <section id="instructorsSection" class="section active">
            <h2 class="section-title">ğŸ‘¨â€ğŸ« Quáº£n lÃ½ giáº£ng viÃªn</h2>
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchInstructorTab('list')">
                    ğŸ‘¥ Danh sÃ¡ch giáº£ng viÃªn
                </button>
                <button class="tab-btn" onclick="switchInstructorTab('add')">
                    â• ThÃªm giáº£ng viÃªn
                </button>
                <button class="tab-btn" onclick="switchInstructorTab('stats')">
                    ğŸ“Š Thá»‘ng kÃª
                </button>
            </div>
            <!-- Instructor List Tab -->
            <div id="instructorListTab" class="tab-content active">
                <div class="search-filter-bar">
                    <input type="text" class="search-input" id="instructorSearchInput"
                        placeholder="ğŸ” TÃ¬m kiáº¿m giáº£ng viÃªn..." onkeyup="filterInstructors()" />
                    <select class="form-select" id="experienceFilter" onchange="filterInstructors()"
                        style="width: auto">
                        <option value="">Táº¥t cáº£ kinh nghiá»‡m</option>
                        <option value="1-3">1-3 nÄƒm</option>
                        <option value="4-7">4-7 nÄƒm</option>
                        <option value="8+">8+ nÄƒm</option>
                    </select>
                    <button class="btn btn-primary" onclick="showAddInstructorModal()">
                        â• ThÃªm giáº£ng viÃªn
                    </button>
                </div>
                <div id="instructorsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Äang táº£i danh sÃ¡ch giáº£ng viÃªn...</p>
                    </div>
                </div>
            </div>
            <!-- Add Instructor Tab -->
            <div id="instructorAddTab" class="tab-content">
                <div class="form-container">
                    <h3 style="
            color: var(--accent-gold);
            margin-bottom: 25px;
            text-align: center;
        ">
                        â• ThÃªm giáº£ng viÃªn má»›i
                    </h3>
                    <form id="quickInstructorForm" onsubmit="quickAddInstructor(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickInstructorName">Há» tÃªn *</label>
                                <input type="text" class="form-input" id="quickInstructorName" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickInstructorEmail">Email *</label>
                                <input type="email" class="form-input" id="quickInstructorEmail" required />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickExperience">Kinh nghiá»‡m (nÄƒm) *</label>
                                <input type="number" class="form-input" id="quickExperience" min="0" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickAvatar">Avatar (emoji) *</label>
                                <input type="text" class="form-input" id="quickAvatar" maxlength="2" required
                                    placeholder="ğŸ‘¨â€ğŸ«" />
                            </div>
                        </div>
                        <div class="form-row full">
                            <div class="form-group">
                                <label class="form-label" for="quickBio">Giá»›i thiá»‡u báº£n thÃ¢n *</label>
                                <textarea class="form-textarea" id="quickBio" rows="4" required
                                    placeholder="Chia sáº» vá» kinh nghiá»‡m, chuyÃªn mÃ´n vÃ  passion..."></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickGithub">GitHub (tÃ¹y chá»n)</label>
                                <input type="url" class="form-input" id="quickGithub"
                                    placeholder="https://github.com/username" />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickLinkedin">LinkedIn (tÃ¹y chá»n)</label>
                                <input type="url" class="form-input" id="quickLinkedin"
                                    placeholder="https://linkedin.com/in/username" />
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 30px">
                            <button type="submit" class="btn btn-primary" style="margin-right: 15px">
                                ğŸ’¾ LÆ°u giáº£ng viÃªn
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetInstructorForm()">
                                ğŸ”„ LÃ m má»›i
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Instructor Stats Tab -->
            <div id="instructorStatsTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¨â€ğŸ«</div>
                        <div class="stat-number" id="totalInstructors">0</div>
                        <div class="stat-label">Tá»•ng giáº£ng viÃªn</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â­</div>
                        <div class="stat-number" id="avgInstructorRating">0</div>
                        <div class="stat-label">ÄÃ¡nh giÃ¡ TB</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“š</div>
                        <div class="stat-number" id="avgCoursesPerInstructor">0</div>
                        <div class="stat-label">KhÃ³a há»c TB/GV</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-number" id="avgExperience">0</div>
                        <div class="stat-label">Kinh nghiá»‡m TB</div>
                    </div>
                </div>
                <div id="instructorStatsDetails">
                    <!-- Detailed instructor statistics will be loaded here -->
                </div>
            </div>
        </section>
    </div>
</main>
<script>
    // Global variables
    let allCourses = [];
    let allInstructors = [];
    let filteredCourses = [];
    let filteredInstructors = [];

    // Default configuration
    const defaultConfig = {
        system_title: "ğŸ“š Course & Instructor Management",
        welcome_text:
            "ChÃ o má»«ng Ä‘áº¿n vá»›i há»‡ thá»‘ng quáº£n lÃ½ khÃ³a há»c vÃ  giáº£ng viÃªn chuyÃªn nghiá»‡p",
    };

    // Subcategory mapping
    const subcategoryMap = {
        IT: [
            "Láº­p trÃ¬nh Web",
            "Láº­p trÃ¬nh thiáº¿t bá»‹ di Ä‘á»™ng",
            "Data Science",
            "DevOps",
            "Cybersecurity",
        ],
        Design: [
            "UI/UX Design",
            "Graphic Design",
            "Web Design",
            "Motion Graphics",
        ],
        Business: ["Quáº£n lÃ½ dá»± Ã¡n", "Khá»Ÿi nghiá»‡p", "TÃ i chÃ­nh", "NhÃ¢n sá»±"],
        Marketing: [
            "Digital Marketing",
            "Content Marketing",
            "SEO/SEM",
            "Social Media",
        ],
    };

    // Data handler for SDK
    const dataHandler = {
        onDataChanged(data) {
            allCourses = data.filter((item) => item.type === "course");
            allInstructors = data.filter((item) => item.type === "instructor");
            updateUI();
        },
    };

    // Initialize SDK and app
    async function initializeApp() {
        if (window.dataSdk) {
            const result = await window.dataSdk.init(dataHandler);
            if (result.isOk) {
                await seedInitialData();
            } else {
                console.error("Failed to initialize data SDK");
            }
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues,
            });
        }

        render(defaultConfig);
    }

    // Render function for Element SDK
    async function render(config) {
        const systemTitle = config.system_title || defaultConfig.system_title;
        const welcomeText = config.welcome_text || defaultConfig.welcome_text;

        document.getElementById("systemTitle").textContent = systemTitle;
        document.getElementById("welcomeText").textContent = welcomeText;
    }

    // Capabilities mapping
    function mapToCapabilities(config) {
        return {
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined,
        };
    }

    // Edit panel values mapping
    function mapToEditPanelValues(config) {
        return new Map([
            ["system_title", config.system_title || defaultConfig.system_title],
            ["welcome_text", config.welcome_text || defaultConfig.welcome_text],
        ]);
    }

    // Seed initial data
    async function seedInitialData() {
        if (allInstructors.length > 0) return; // Data already exists

        // Sample instructors
        const sampleInstructors = [
            {
                id: "instructor_1",
                type: "instructor",
                user_name: "Nguyá»…n VÄƒn Minh",
                user_email: "minh.instructor@example.com",
                bio: "Senior Python Developer vá»›i 8+ nÄƒm kinh nghiá»‡m trong phÃ¡t triá»ƒn web vÃ  á»©ng dá»¥ng enterprise. ÄÃ£ lÃ m viá»‡c táº¡i cÃ¡c cÃ´ng ty cÃ´ng nghá»‡ hÃ ng Ä‘áº§u.",
                experience: "8",
                avatar: "ğŸ",
                social_links: JSON.stringify({
                    github: "https://github.com/minhpython",
                    linkedin: "https://linkedin.com/in/minhpython",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_2",
                type: "instructor",
                user_name: "Tráº§n Thá»‹ Lan",
                user_email: "lan.instructor@example.com",
                bio: "Frontend Architect vá»›i chuyÃªn mÃ´n sÃ¢u vá» React.js vÃ  cÃ¡c cÃ´ng nghá»‡ frontend hiá»‡n Ä‘áº¡i. CÃ³ kinh nghiá»‡m mentoring team.",
                experience: "6",
                avatar: "âš¡",
                social_links: JSON.stringify({
                    github: "https://github.com/lanreact",
                    linkedin: "https://linkedin.com/in/lanreact",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_3",
                type: "instructor",
                user_name: "LÃª VÄƒn Äá»©c",
                user_email: "duc.instructor@example.com",
                bio: "Lead UX Designer vá»›i portfolio Ä‘a dáº¡ng tá»« startup Ä‘áº¿n enterprise. ChuyÃªn gia trong nghiÃªn cá»©u ngÆ°á»i dÃ¹ng vÃ  thiáº¿t káº¿ tráº£i nghiá»‡m.",
                experience: "7",
                avatar: "ğŸ¨",
                social_links: JSON.stringify({
                    behance: "https://behance.net/ducux",
                    linkedin: "https://linkedin.com/in/ducux",
                }),
                created_at: new Date().toISOString(),
            },
        ];

        // Sample courses
        const sampleCourses = [
            {
                id: "course_1",
                type: "course",
                title: "Advanced Python Programming",
                description:
                    "NÃ¢ng cao ká»¹ nÄƒng láº­p trÃ¬nh Python vá»›i cÃ¡c ká»¹ thuáº­t advanced vÃ  best practices tá»« cÃ¡c chuyÃªn gia hÃ ng Ä‘áº§u trong ngÃ nh.",
                category: "IT",
                subcategory: "Láº­p trÃ¬nh Web",
                instructor: "Nguyá»…n VÄƒn Minh",
                instructor_id: "instructor_1",
                rating: 4.9,
                reviews: 1234,
                students: 5678,
                price: 1299000,
                discount_price: 999000,
                image: "ğŸ",
                status: "completed",
                chapters: JSON.stringify([
                    "Giá»›i thiá»‡u Python Advanced",
                    "Object-Oriented Programming",
                    "Decorators vÃ  Generators",
                    "Async Programming",
                    "Testing vÃ  Debugging",
                ]),
                requirements:
                    "Kiáº¿n thá»©c cÆ¡ báº£n vá» Python\nHiá»ƒu vá» láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng",
                what_you_learn:
                    "Náº¯m vá»¯ng cÃ¡c ká»¹ thuáº­t Python nÃ¢ng cao\nXÃ¢y dá»±ng á»©ng dá»¥ng web vá»›i Django/Flask\nTá»‘i Æ°u hÃ³a hiá»‡u suáº¥t code\nViáº¿t test cases chuyÃªn nghiá»‡p",
                target_audience:
                    "Láº­p trÃ¬nh viÃªn Python cÃ³ kinh nghiá»‡m\nSinh viÃªn IT muá»‘n nÃ¢ng cao ká»¹ nÄƒng",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_2",
                type: "course",
                title: "React.js Mastery",
                description:
                    "Trá»Ÿ thÃ nh chuyÃªn gia React.js vá»›i khÃ³a há»c toÃ n diá»‡n tá»« cÆ¡ báº£n Ä‘áº¿n nÃ¢ng cao, bao gá»“m hooks, context, vÃ  cÃ¡c pattern hiá»‡n Ä‘áº¡i.",
                category: "IT",
                subcategory: "Láº­p trÃ¬nh Web",
                instructor: "Tráº§n Thá»‹ Lan",
                instructor_id: "instructor_2",
                rating: 4.8,
                reviews: 987,
                students: 3456,
                price: 1599000,
                discount_price: 1199000,
                image: "âš¡",
                status: "incomplete",
                chapters: JSON.stringify([
                    "React Fundamentals",
                    "Components vÃ  Props",
                    "State Management",
                    "React Hooks",
                    "Advanced Patterns",
                ]),
                requirements: "Kiáº¿n thá»©c HTML, CSS, JavaScript\nHiá»ƒu vá» ES6+",
                what_you_learn:
                    "XÃ¢y dá»±ng á»©ng dá»¥ng React tá»« Ä‘áº§u\nQuáº£n lÃ½ state hiá»‡u quáº£\nSá»­ dá»¥ng hooks vÃ  context",
                target_audience: "Frontend developers\nSinh viÃªn muá»‘n há»c React",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_3",
                type: "course",
                title: "UI/UX Design Complete",
                description:
                    "KhÃ³a há»c thiáº¿t káº¿ UI/UX hoÃ n chá»‰nh vá»›i cÃ¡c dá»± Ã¡n thá»±c táº¿ vÃ  portfolio chuyÃªn nghiá»‡p, tá»« research Ä‘áº¿n prototype.",
                category: "Design",
                subcategory: "UI/UX Design",
                instructor: "LÃª VÄƒn Äá»©c",
                instructor_id: "instructor_3",
                rating: 4.7,
                reviews: 756,
                students: 2345,
                price: 1799000,
                discount_price: 1399000,
                image: "ğŸ¨",
                status: "completed",
                chapters: JSON.stringify([
                    "Design Thinking",
                    "User Research",
                    "Wireframing",
                    "Prototyping",
                    "Visual Design",
                ]),
                requirements:
                    "KhÃ´ng cáº§n kinh nghiá»‡m trÆ°á»›c\nMÃ¡y tÃ­nh cÃ³ thá»ƒ cháº¡y Figma",
                what_you_learn:
                    "Quy trÃ¬nh thiáº¿t káº¿ UX hoÃ n chá»‰nh\nSá»­ dá»¥ng Figma chuyÃªn nghiá»‡p\nTáº¡o prototype tÆ°Æ¡ng tÃ¡c",
                target_audience:
                    "NgÆ°á»i má»›i báº¯t Ä‘áº§u vá»›i UX/UI\nGraphic designer muá»‘n chuyá»ƒn ngÃ nh",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
        ];

        // Create instructors first
        for (const instructor of sampleInstructors) {
            const result = await window.dataSdk.create(instructor);
            if (!result.isOk) {
                console.error("Failed to create instructor:", instructor.user_name);
            }
        }

        // Then create courses
        for (const course of sampleCourses) {
            const result = await window.dataSdk.create(course);
            if (!result.isOk) {
                console.error("Failed to create course:", course.title);
            }
        }
    }

    // Update UI based on data
    function updateUI() {
        filteredCourses = [...allCourses];
        filteredInstructors = [...allInstructors];

        updateCoursesList();
        updateInstructorsList();
        updateCourseStats();
        updateInstructorStats();
        loadInstructorOptions();
    }

    // Section navigation
    function showSection(sectionName) {
        // Update nav links
        document
            .querySelectorAll(".nav-link")
            .forEach((link) => link.classList.remove("active"));
        event.target.classList.add("active");

        // Hide all sections
        document
            .querySelectorAll(".section")
            .forEach((section) => section.classList.remove("active"));

        // Show selected section
        document
            .getElementById(sectionName + "Section")
            .classList.add("active");
    }

    // Course Management Functions
    function switchCourseTab(tabName) {
        document
            .querySelectorAll("#coursesSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#coursesSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "course" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateCourseStats();
        }
    }

    function updateCoursesList() {
        const container = document.getElementById("coursesList");

        if (filteredCourses.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>ğŸ“š ChÆ°a cÃ³ khÃ³a há»c nÃ o</h3>
                    <p>HÃ£y thÃªm khÃ³a há»c Ä‘áº§u tiÃªn</p>
                    <button class="btn btn-primary" onclick="switchCourseTab('add')">â• ThÃªm khÃ³a há»c</button>
                </div>
            `;
            return;
        }

        const coursesHtml = filteredCourses
            .map(
                (course) => `
            <div class="card">
                <div class="card-header">
                    <div class="card-avatar">${course.image}</div>
                    <div class="card-info">
                        <h3>${course.title}</h3>
                        <p>${course.category} â€¢ ${course.subcategory}</p>
                    </div>
                </div>
                <div class="card-content">
                    <p>${course.description.substring(0, 120)}...</p>
                </div>
                <div class="card-meta">
                    <div class="meta-badge">ğŸ‘¨â€ğŸ« ${course.instructor}</div>
                    <div class="meta-badge">â­ ${course.rating}</div>
                    <div class="meta-badge">ğŸ‘¥ ${course.students}</div>
                    <span class="status-badge status-${course.status}">
                        ${course.status === "completed"
                        ? "HoÃ n thÃ nh"
                        : course.status === "incomplete"
                            ? "ChÆ°a hoÃ n thÃ nh"
                            : "Báº£n nhÃ¡p"
                    }
                    </span>
                </div>
                <div class="price-display">
                    <span class="price-current">${formatPrice(
                        course.discount_price || course.price
                    )}</span>
                    ${course.discount_price
                        ? `<span class="price-original">${formatPrice(
                            course.price
                        )}</span>`
                        : ""
                    }
                </div>
                <div class="card-actions">
                    <button class="btn btn-primary btn-sm" onclick="viewCourseDetail('${course.id
                    }')">ğŸ‘ï¸ Xem chi tiáº¿t</button>
                    <button class="btn btn-secondary btn-sm" onclick="editCourse('${course.id
                    }')">âœï¸ Sá»­a</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteCourseConfirm('${course.id
                    }')">ğŸ—‘ï¸ XÃ³a</button>
                </div>
            </div>
        `
            )
            .join("");

        container.innerHTML = `<div class="card-grid">${coursesHtml}</div>`;
    }

    function filterCourses() {
        const searchTerm = document
            .getElementById("courseSearchInput")
            .value.toLowerCase();
        const categoryFilter = document.getElementById("categoryFilter").value;
        const statusFilter = document.getElementById("statusFilter").value;

        filteredCourses = allCourses.filter((course) => {
            const matchesSearch =
                !searchTerm ||
                course.title.toLowerCase().includes(searchTerm) ||
                course.description.toLowerCase().includes(searchTerm) ||
                course.instructor.toLowerCase().includes(searchTerm);

            const matchesCategory =
                !categoryFilter || course.category === categoryFilter;
            const matchesStatus = !statusFilter || course.status === statusFilter;

            return matchesSearch && matchesCategory && matchesStatus;
        });

        updateCoursesList();
    }

    function updateQuickSubcategories() {
        const category = document.getElementById("quickCategory").value;
        const subcategorySelect = document.getElementById("quickSubcategory");

        subcategorySelect.innerHTML =
            '<option value="">Chá»n chuyÃªn ngÃ nh</option>';

        if (category && subcategoryMap[category]) {
            subcategoryMap[category].forEach((sub) => {
                const option = document.createElement("option");
                option.value = sub;
                option.textContent = sub;
                subcategorySelect.appendChild(option);
            });
        }
    }

    function loadInstructorOptions() {
        const select = document.getElementById("quickInstructor");
        select.innerHTML = '<option value="">Chá»n giáº£ng viÃªn</option>';

        allInstructors.forEach((instructor) => {
            const option = document.createElement("option");
            option.value = instructor.id;
            option.textContent = `${instructor.avatar} ${instructor.user_name}`;
            select.appendChild(option);
        });
    }

    async function quickAddCourse(event) {
        event.preventDefault();

        if (allCourses.length >= 999) {
            showToast("ÄÃ£ Ä‘áº¡t giá»›i háº¡n tá»‘i Ä‘a 999 khÃ³a há»c!", "error");
            return;
        }

        const instructorId = document.getElementById("quickInstructor").value;
        const instructor = allInstructors.find((i) => i.id === instructorId);

        if (!instructor) {
            showToast("Vui lÃ²ng chá»n giáº£ng viÃªn!", "error");
            return;
        }

        const newCourse = {
            id: "course_" + Date.now(),
            type: "course",
            title: document.getElementById("quickTitle").value,
            description: document.getElementById("quickDescription").value,
            category: document.getElementById("quickCategory").value,
            subcategory: document.getElementById("quickSubcategory").value,
            instructor: instructor.user_name,
            instructor_id: instructorId,
            rating: 0,
            reviews: 0,
            students: 0,
            price: parseInt(document.getElementById("quickPrice").value),
            discount_price: null,
            image: document.getElementById("quickImage").value || "ğŸ“š",
            status: "draft",
            chapters: JSON.stringify(["ChÆ°Æ¡ng 1: Giá»›i thiá»‡u"]),
            requirements: "",
            what_you_learn: "",
            target_audience: "",
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newCourse);
        if (result.isOk) {
            showToast("Táº¡o khÃ³a há»c thÃ nh cÃ´ng!", "success");
            resetQuickForm();
            switchCourseTab("list");
        } else {
            showToast("Táº¡o khÃ³a há»c tháº¥t báº¡i!", "error");
        }
    }

    function resetQuickForm() {
        document.getElementById("quickCourseForm").reset();
        document.getElementById("quickSubcategory").innerHTML =
            '<option value="">Chá»n chuyÃªn ngÃ nh</option>';
    }

    function updateCourseStats() {
        const totalCourses = allCourses.length;
        const completedCourses = allCourses.filter(
            (c) => c.status === "completed"
        ).length;
        const incompleteCourses = allCourses.filter(
            (c) => c.status === "incomplete"
        ).length;
        const totalStudents = allCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );

        document.getElementById("totalCourses").textContent = totalCourses;
        document.getElementById("completedCourses").textContent =
            completedCourses;
        document.getElementById("incompleteCourses").textContent =
            incompleteCourses;
        document.getElementById("totalStudents").textContent = totalStudents;

        // Category statistics
        const categoryStats = {};
        allCourses.forEach((course) => {
            if (!categoryStats[course.category]) {
                categoryStats[course.category] = {
                    total: 0,
                    completed: 0,
                    students: 0,
                };
            }
            categoryStats[course.category].total++;
            if (course.status === "completed") {
                categoryStats[course.category].completed++;
            }
            categoryStats[course.category].students += course.students;
        });

        const categoryStatsHtml = Object.entries(categoryStats)
            .map(
                ([category, stats]) => `
            <div class="category-stats">
                <h4>ğŸ“Š ${category}</h4>
                <div class="category-item">
                    <span>Tá»•ng khÃ³a há»c:</span>
                    <span>${stats.total}</span>
                </div>
                <div class="category-item">
                    <span>ÄÃ£ hoÃ n thÃ nh:</span>
                    <span>${stats.completed}</span>
                </div>
                <div class="category-item">
                    <span>Tá»•ng há»c viÃªn:</span>
                    <span>${stats.students}</span>
                </div>
            </div>
        `
            )
            .join("");

        document.getElementById("categoryStatsContainer").innerHTML =
            categoryStatsHtml;
    }

    // Instructor Management Functions
    function switchInstructorTab(tabName) {
        document
            .querySelectorAll("#instructorsSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#instructorsSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "instructor" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateInstructorStats();
        }
    }

    function updateInstructorsList() {
        const container = document.getElementById("instructorsList");

        if (filteredInstructors.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>ğŸ‘¨â€ğŸ« ChÆ°a cÃ³ giáº£ng viÃªn nÃ o</h3>
                    <p>HÃ£y thÃªm giáº£ng viÃªn Ä‘áº§u tiÃªn</p>
                    <button class="btn btn-primary" onclick="switchInstructorTab('add')">â• ThÃªm giáº£ng viÃªn</button>
                </div>
            `;
            return;
        }

        const instructorsHtml = filteredInstructors
            .map((instructor) => {
                const instructorCourses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = instructorCourses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    instructorCourses.length > 0
                        ? (
                            instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                            instructorCourses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-avatar">${instructor.avatar}</div>
                        <div class="card-info">
                            <h3>${instructor.user_name}</h3>
                            <p>ğŸ“§ ${instructor.user_email}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <p>${instructor.bio.substring(0, 120)}...</p>
                    </div>
                    <div class="card-meta">
                        <div class="meta-badge">ğŸ¯ ${instructor.experience
                    }+ nÄƒm</div>
                        <div class="meta-badge">ğŸ“š ${instructorCourses.length
                    } khÃ³a há»c</div>
                        <div class="meta-badge">ğŸ‘¥ ${totalStudents} há»c viÃªn</div>
                        <div class="meta-badge">â­ ${avgRating}</div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary btn-sm" onclick="viewInstructorDetail('${instructor.id
                    }')">ğŸ‘ï¸ Xem chi tiáº¿t</button>
                        <button class="btn btn-secondary btn-sm" onclick="editInstructor('${instructor.id
                    }')">âœï¸ Sá»­a</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteInstructorConfirm('${instructor.id
                    }')">ğŸ—‘ï¸ XÃ³a</button>
                    </div>
                </div>
            `;
            })
            .join("");

        container.innerHTML = `<div class="card-grid">${instructorsHtml}</div>`;
    }

    function filterInstructors() {
        const searchTerm = document
            .getElementById("instructorSearchInput")
            .value.toLowerCase();
        const experienceFilter =
            document.getElementById("experienceFilter").value;

        filteredInstructors = allInstructors.filter((instructor) => {
            const matchesSearch =
                !searchTerm ||
                instructor.user_name.toLowerCase().includes(searchTerm) ||
                instructor.user_email.toLowerCase().includes(searchTerm) ||
                instructor.bio.toLowerCase().includes(searchTerm);

            let matchesExperience = true;
            if (experienceFilter) {
                const exp = parseInt(instructor.experience);
                switch (experienceFilter) {
                    case "1-3":
                        matchesExperience = exp >= 1 && exp <= 3;
                        break;
                    case "4-7":
                        matchesExperience = exp >= 4 && exp <= 7;
                        break;
                    case "8+":
                        matchesExperience = exp >= 8;
                        break;
                }
            }

            return matchesSearch && matchesExperience;
        });

        updateInstructorsList();
    }

    async function quickAddInstructor(event) {
        event.preventDefault();

        if (allInstructors.length >= 999) {
            showToast("ÄÃ£ Ä‘áº¡t giá»›i háº¡n tá»‘i Ä‘a 999 giáº£ng viÃªn!", "error");
            return;
        }

        const email = document.getElementById("quickInstructorEmail").value;
        const existingInstructor = allInstructors.find(
            (i) => i.user_email === email
        );

        if (existingInstructor) {
            showToast("Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng!", "error");
            return;
        }

        const socialLinks = {
            github: document.getElementById("quickGithub").value,
            linkedin: document.getElementById("quickLinkedin").value,
        };

        const newInstructor = {
            id: "instructor_" + Date.now(),
            type: "instructor",
            user_name: document.getElementById("quickInstructorName").value,
            user_email: email,
            bio: document.getElementById("quickBio").value,
            experience: document.getElementById("quickExperience").value,
            avatar: document.getElementById("quickAvatar").value,
            social_links: JSON.stringify(socialLinks),
            created_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newInstructor);
        if (result.isOk) {
            showToast("ThÃªm giáº£ng viÃªn thÃ nh cÃ´ng!", "success");
            resetInstructorForm();
            switchInstructorTab("list");
        } else {
            showToast("ThÃªm giáº£ng viÃªn tháº¥t báº¡i!", "error");
        }
    }

    function resetInstructorForm() {
        document.getElementById("quickInstructorForm").reset();
    }

    function updateInstructorStats() {
        const totalInstructors = allInstructors.length;
        const avgRating =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce((sum, instructor) => {
                        const courses = allCourses.filter(
                            (c) => c.instructor_id === instructor.id
                        );
                        const instructorAvgRating =
                            courses.length > 0
                                ? courses.reduce((sum, c) => sum + c.rating, 0) /
                                courses.length
                                : 0;
                        return sum + instructorAvgRating;
                    }, 0) / allInstructors.length
                ).toFixed(1)
                : 0;

        const avgCoursesPerInstructor =
            totalInstructors > 0
                ? (allCourses.length / totalInstructors).toFixed(1)
                : 0;

        const avgExperience =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce(
                        (sum, i) => sum + parseInt(i.experience),
                        0
                    ) / allInstructors.length
                ).toFixed(1)
                : 0;

        document.getElementById("totalInstructors").textContent =
            totalInstructors;
        document.getElementById("avgInstructorRating").textContent = avgRating;
        document.getElementById("avgCoursesPerInstructor").textContent =
            avgCoursesPerInstructor;
        document.getElementById("avgExperience").textContent = avgExperience;

        // Detailed instructor statistics
        const instructorStatsHtml = allInstructors
            .map((instructor) => {
                const courses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = courses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    courses.length > 0
                        ? (
                            courses.reduce((sum, c) => sum + c.rating, 0) /
                            courses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="category-stats">
                    <h4>${instructor.avatar} ${instructor.user_name}</h4>
                    <div class="category-item">
                        <span>Sá»‘ khÃ³a há»c:</span>
                        <span>${courses.length}</span>
                    </div>
                    <div class="category-item">
                        <span>Tá»•ng há»c viÃªn:</span>
                        <span>${totalStudents}</span>
                    </div>
                    <div class="category-item">
                        <span>ÄÃ¡nh giÃ¡ trung bÃ¬nh:</span>
                        <span>${avgRating}</span>
                    </div>
                    <div class="category-item">
                        <span>Kinh nghiá»‡m:</span>
                        <span>${instructor.experience} nÄƒm</span>
                    </div>
                </div>
            `;
            })
            .join("");

        document.getElementById("instructorStatsDetails").innerHTML =
            instructorStatsHtml;
    }

    // Detail view functions
    function viewCourseDetail(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        const instructor = allInstructors.find(
            (i) => i.id === course.instructor_id
        );
        const chapters = JSON.parse(course.chapters || "[]");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin-right: 20px;">
                        ${course.image}
                    </div>
                    <div>
                        <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${course.title
            }</h2>
                        <p style="color: var(--light-silver); margin: 0;">${course.category
            } â€¢ ${course.subcategory}</p>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“‹ MÃ´ táº£</h4>
                    <p style="color: white; line-height: 1.6;">${course.description
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ’° ThÃ´ng tin giÃ¡</h4>
                        <div style="color: white;">
                            <div>GiÃ¡ gá»‘c: ${formatPrice(course.price)}</div>
                            ${course.discount_price
                ? `<div>GiÃ¡ khuyáº¿n mÃ£i: ${formatPrice(
                    course.discount_price
                )}</div>`
                : ""
            }
                        </div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“Š Thá»‘ng kÃª</h4>
                        <div style="color: white;">
                            <div>â­ ${course.rating} (${course.reviews
            } Ä‘Ã¡nh giÃ¡)</div>
                            <div>ğŸ‘¥ ${course.students} há»c viÃªn</div>
                            <div>ğŸ“… ${new Date(
                course.created_at
            ).toLocaleDateString("vi-VN")}</div>
                        </div>
                    </div>
                </div>

                ${instructor
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ‘¨â€ğŸ« Giáº£ng viÃªn</h4>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-right: 15px;">
                                ${instructor.avatar}
                            </div>
                            <div>
                                <div style="color: white; font-weight: bold;">${instructor.user_name}</div>
                                <div style="color: var(--light-silver);">${instructor.experience}+ nÄƒm kinh nghiá»‡m</div>
                            </div>
                        </div>
                    </div>
                `
                : ""
            }

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“š ChÆ°Æ¡ng trÃ¬nh há»c</h4>
                    <div>
                        ${chapters
                .map(
                    (chapter, index) => `
                            <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; color: white;">
                                ChÆ°Æ¡ng ${index + 1}: ${chapter}
                            </div>
                        `
                )
                .join("")}
                    </div>
                </div>
            </div>
        `;

        document.getElementById("courseModalContent").innerHTML = detailHtml;
        document.getElementById("courseModalTitle").textContent = course.title;
        document.getElementById("courseModal").classList.add("show");
    }

    function viewInstructorDetail(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        const totalStudents = instructorCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );
        const avgRating =
            instructorCourses.length > 0
                ? (
                    instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                    instructorCourses.length
                ).toFixed(1)
                : 0;

        const socialLinks = JSON.parse(instructor.social_links || "{}");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 120px; height: 120px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px;">
                        ${instructor.avatar}
                    </div>
                    <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${instructor.user_name
            }</h2>
                    <p style="color: var(--light-silver); margin: 0;">ğŸ“§ ${instructor.user_email
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructorCourses.length
            }</div>
                        <div style="color: white; font-size: 0.9rem;">KhÃ³a há»c</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${totalStudents}</div>
                        <div style="color: white; font-size: 0.9rem;">Há»c viÃªn</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${avgRating}</div>
                        <div style="color: white; font-size: 0.9rem;">ÄÃ¡nh giÃ¡ TB</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructor.experience
            }</div>
                        <div style="color: white; font-size: 0.9rem;">NÄƒm KN</div>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“ Giá»›i thiá»‡u</h4>
                    <p style="color: white; line-height: 1.6;">${instructor.bio
            }</p>
                </div>

                ${Object.keys(socialLinks).length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ”— LiÃªn káº¿t</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            ${socialLinks.github
                    ? `<a href="${socialLinks.github}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">ğŸ™ GitHub</a>`
                    : ""
                }
                            ${socialLinks.linkedin
                    ? `<a href="${socialLinks.linkedin}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">ğŸ’¼ LinkedIn</a>`
                    : ""
                }
                            ${socialLinks.behance
                    ? `<a href="${socialLinks.behance}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">ğŸ¨ Behance</a>`
                    : ""
                }
                        </div>
                    </div>
                `
                : ""
            }

                ${instructorCourses.length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ“š KhÃ³a há»c giáº£ng dáº¡y</h4>
                        <div>
                            ${instructorCourses
                    .map(
                        (course) => `
                                <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: var(--accent-gold); font-weight: bold;">${course.title}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.category} â€¢ ${course.subcategory}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: white;">â­ ${course.rating}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.students} há»c viÃªn</div>
                                    </div>
                                </div>
                            `
                    )
                    .join("")}
                        </div>
                    </div>
                `
                : ""
            }
            </div>
        `;

        document.getElementById("instructorModalContent").innerHTML =
            detailHtml;
        document.getElementById("instructorModalTitle").textContent =
            instructor.user_name;
        document.getElementById("instructorModal").classList.add("show");
    }

    // Delete confirmation functions
    async function deleteCourseConfirm(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        if (confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a khÃ³a há»c "${course.title}"?`)) {
            const result = await window.dataSdk.delete(course);
            if (result.isOk) {
                showToast("XÃ³a khÃ³a há»c thÃ nh cÃ´ng!", "success");
            } else {
                showToast("XÃ³a khÃ³a há»c tháº¥t báº¡i!", "error");
            }
        }
    }

    async function deleteInstructorConfirm(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        if (instructorCourses.length > 0) {
            showToast("KhÃ´ng thá»ƒ xÃ³a giáº£ng viÃªn Ä‘ang cÃ³ khÃ³a há»c!", "error");
            return;
        }

        if (
            confirm(
                `Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a giáº£ng viÃªn "${instructor.user_name}"?`
            )
        ) {
            const result = await window.dataSdk.delete(instructor);
            if (result.isOk) {
                showToast("XÃ³a giáº£ng viÃªn thÃ nh cÃ´ng!", "success");
            } else {
                showToast("XÃ³a giáº£ng viÃªn tháº¥t báº¡i!", "error");
            }
        }
    }

    // Modal functions
    function closeCourseModal() {
        document.getElementById("courseModal").classList.remove("show");
    }

    function closeInstructorModal() {
        document.getElementById("instructorModal").classList.remove("show");
    }

    // Utility functions
    function formatPrice(price) {
        return new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
        }).format(price);
    }

    function showToast(message, type = "info") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => {
            toast.classList.add("show");
        }, 100);

        setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    // Initialize app when page loads
    document.addEventListener("DOMContentLoaded", initializeApp);
</script>
<script>
    (function () {
        function c() {
            var b = a.contentDocument || a.contentWindow.document;
            if (b) {
                var d = b.createElement("script");
                d.innerHTML =
                    "window.__CF$cv$params={r:'9929e89230c5fd8b',t:'MTc2MTE0NTY5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
                b.getElementsByTagName("head")[0].appendChild(d);
            }
        }
        if (document.body) {
            var a = document.createElement("iframe");
            a.height = 1;
            a.width = 1;
            a.style.position = "absolute";
            a.style.top = 0;
            a.style.left = 0;
            a.style.border = "none";
            a.style.visibility = "hidden";
            document.body.appendChild(a);
            if ("loading" !== document.readyState) c();
            else if (window.addEventListener)
                document.addEventListener("DOMContentLoaded", c);
            else {
                var e = document.onreadystatechange || function () { };
                document.onreadystatechange = function (b) {
                    e(b);
                    "loading" !== document.readyState &&
                        ((document.onreadystatechange = e), c());
                };
            }
        }
    })();
>>>>>>> main
</script>
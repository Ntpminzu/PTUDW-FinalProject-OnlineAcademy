{{#section "styles" append=true}}
<link rel="stylesheet" href="/course-form.css" />
<script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
{{/section}}

<main class="main-content">
    <div class="container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title" id="welcomeTitle">
                Course Management System &amp; Instructor Portal
            </h1>
            <p class="welcome-text" id="welcomeText">
                Welcome to your personal course management dashboard.
            </p>
        </div>
        <!-- Course Management Section -->
        <section id="coursesSection" class="section active">
            <h2 class="section-title">üìö Course Management</h2>
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchCourseTab('list')">
                    üìã Course List
                </button>
                <button class="tab-btn" onclick="switchCourseTab('add')">
                    ‚ûï Add Course
                </button>
                <button class="tab-btn" onclick="switchCourseTab('stats')">
                    üìä Stats
                </button>
            </div>

            <!-- Add Course Tab -->
            {{! ----- B·∫ÆT ƒê·∫¶U THAY TH·∫æ TAB TH√äM KH√ìA H·ªåC ----- }}
            <div id="courseAddTab" class="tab-content">

                {{! Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥ }}
                {{#if errorAdd}}
                <div class="alert alert-danger" role="alert"
                    style="background-color: #c0392b; color: white; border: none; margin: 0 auto 20px auto; max-width: 900px; text-align: center; font-weight: bold;">
                    {{errorAdd}}
                </div>
                {{/if}}

                <div class="form-container" style="max-width: 900px; margin: 0 auto;">
                    {{! Form POST ƒë·∫øn route backend }}
                    <form action="/management/course/add" method="POST">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="CourseName">Course name *</label>
                                {{! D√πng formData ƒë·ªÉ gi·ªØ l·∫°i gi√° tr·ªã c≈© n·∫øu c√≥ l·ªói }}
                                <input type="text" class="form-input" id="CourseName" name="CourseName"
                                    value="{{formData.CourseName}}" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="Level">Level *</label>
                                <select class="form-select" id="Level" name="Level" required>
                                    <option value="" {{#unless formData.Level}}selected{{/unless}}>Select Level
                                    </option>
                                    <option value="Beginner" {{#if (eq formData.Level "Beginner" )}}selected{{/if}}>
                                        Beginner</option>
                                    <option value="Intermediate" {{#if (eq formData.Level "Intermediate"
                                        )}}selected{{/if}}>Intermediate</option>
                                    <option value="Advanced" {{#if (eq formData.Level "Advanced" )}}selected{{/if}}>
                                        Advanced</option>
                                    <option value="Expert" {{#if (eq formData.Level "Expert" )}}selected{{/if}}>
                                        Expert</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row full">
                            <div class="form-group">
                                <label class="form-label" for="CatID">Category *</label>
                                <select class="form-select" id="CatID" name="CatID" required>
                                    <option value="" {{#unless formData.CatID}}selected{{/unless}}>Select Category
                                    </option>
                                    {{! S·ª≠ d·ª•ng bi·∫øn 'categories' ƒë∆∞·ª£c truy·ªÅn t·ª´ route GET /course }}
                                    {{#each categories}}
                                    <option value="{{CatID}}" {{#if (eq ../formData.CatID CatID)}}selected{{/if}}>
                                        {{CatName}}</option>
                                    {{/each}}
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="OriginalPrice">Original Price (VNƒê) *</label>
                                <input type="number" class="form-input" id="OriginalPrice" name="OriginalPrice" min="0"
                                    value="{{#if formData.OriginalPrice}}{{formData.OriginalPrice}}{{else}}0{{/if}}"
                                    required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="CurrentPrice">Current Price (VNƒê) *</label>
                                <input type="number" class="form-input" id="CurrentPrice" name="CurrentPrice" min="0"
                                    value="{{#if formData.CurrentPrice}}{{formData.CurrentPrice}}{{else}}0{{/if}}"
                                    required />
                            </div>
                        </div>

                        <div class="form-row full">
                            <div class="form-group">
                                <label class="form-label" for="ImageUrl">Image URL (T√πy ch·ªçn)</label>
                                <input type="url" class="form-input" id="ImageUrl" name="ImageUrl"
                                    value="{{formData.ImageUrl}}" placeholder="https://..." />
                            </div>
                        </div>

                        <div class="form-row full">
                            <div class="form-group">
                                <label class="form-label" for="TinyDes">Tiny Description *</label>
                                <textarea class="form-textarea" id="TinyDes" name="TinyDes" rows="3" required
                                    placeholder="Brief description of the course...">{{formData.TinyDes}}</textarea>
                            </div>
                        </div>
                        <div class="form-row full">
                            <div class="form-group">
                                <label class="form-label" for="FullDes">Full Description *</label>
                                <textarea class="form-textarea" id="FullDes" name="FullDes" rows="6" required
                                    placeholder="Detailed description of course content and objectives...">{{formData.FullDes}}</textarea>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 30px">
                            <button type="submit" class="btn btn-primary">
                                ‚ûï Create
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            {{! ----- K·∫æT TH√öC THAY TH·∫æ TAB TH√äM KH√ìA H·ªåC ----- }}
            {{! Tab Th·ªëng k√™ (Gi·ªØ nguy√™n) }}
            <div id="courseStatsTab" class="tab-content">
                <p>Logic cho th·ªëng k√™ s·∫Ω ƒë∆∞·ª£c x√¢y d·ª±ng ·ªü ƒë√¢y.</p>
            </div>

            {{! Tab Danh s√°ch (C·∫ßn s·ª≠a ƒë·ªÉ hi·ªÉn th·ªã ƒë√∫ng d·ªØ li·ªáu) }}
            <div id="courseListTab" class="tab-content active">
                {{! ... Ph·∫ßn hi·ªÉn th·ªã danh s√°ch kh√≥a h·ªçc ... B·∫°n c·∫ßn s·ª≠a l·∫°i ph·∫ßn n√†y ƒë·ªÉ d√πng bi·∫øn 'courses' thay v√¨
                script }}
                <div class="search-filter-bar">
                    <input type="text" class="search-input" placeholder="üîç T√¨m ki·∫øm kh√≥a h·ªçc..." />
                    <select class="form-select" id="categoryFilter" style="width: auto">
                        <option value="*">All Categories</option>
                        {{#each categories}} {{! D√πng categories t·ª´ route GET}}
                        <option value="{{CatName}}">{{CatName}}</option>
                        {{/each}}
                    </select>
                    <select class="form-select" id="statusFilter" style="width: auto">
                        <option value="">All State</option>
                        {{#each courses}} {{! D√πng courses t·ª´ route GET}}
                        <option value="{{CourseStatus}}">{{CourseStatus}}</option>
                        {{/each}}
                    </select>
                </div>

                <div id="coursesList">
                    <div class="card-grid">
                        {{#each courses}} {{! D√πng courses t·ª´ route GET}}
                        <div class="card">
                            <div class="card-header">
                                <div class="card-avatar">üìö</div>
                                <div class="card-info">
                                    <h3>{{CourseName}}</h3>
                                    {{! C·∫ßn join ƒë·ªÉ l·∫•y t√™n Gi·∫£ng vi√™n v√† Category }}
                                    <p>ID: {{CourseID}} | CatID: {{CatID}}</p>
                                </div>
                            </div>
                            <div class="card-content">
                                <p>{{TinyDes}}</p>
                            </div>
                            <div class="card-meta">
                                <div class="meta-badge">‚≠ê {{Rating}}</div>
                                <div class="meta-badge">üë• {{TotalStudent}}</div>
                                <span class="status-badge status-{{CourseStatus}}">{{CourseStatus}}</span>
                            </div>
                            <div class="price-display">
                                <span class="price-current">{{CurrentPrice}} VNƒê</span>
                                <span class="price-original">{{OriginalPrice}} VNƒê</span>
                            </div>
                            <div class="card-actions">
                                {{! Th√™m link/button S·ª≠a/X√≥a sau }}
                                <button class="btn btn-secondary btn-sm">‚úèÔ∏è Edit</button>
                                <button class="btn btn-danger btn-sm">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                        {{else}}
                        <div class="empty-state">
                            <h3>üìö You do not have any courses yet.</h3>
                            <p>Go to the "Add Course" tab to create your first course.</p>
                        </div>
                        {{/each}}
                    </div>
                </div>
                <div id="coursesList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading courses...</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

{{! D√°n ƒëo·∫°n script n√†y v√†o cu·ªëi file course-mgm.hbs SAU KHI X√ìA 2 SCRIPT C≈® }}
<script>
    function switchCourseTab(tabName) {
        // ·∫®n t·∫•t c·∫£ c√°c tab content v√† b·ªè active kh·ªèi c√°c n√∫t tab
        document.querySelectorAll("#coursesSection .tab-btn").forEach(btn => btn.classList.remove("active"));
        document.querySelectorAll("#coursesSection .tab-content").forEach(content => content.classList.remove("active"));

        // Hi·ªán tab content ƒë∆∞·ª£c ch·ªçn v√† ƒë√°nh d·∫•u active cho n√∫t tab t∆∞∆°ng ·ª©ng
        // Gi·∫£ s·ª≠ event l√† bi·∫øn to√†n c·ª•c ho·∫∑c b·∫°n c·∫ßn truy·ªÅn n√≥ v√†o h√†m
        if (event && event.target) {
            event.target.classList.add("active");
        } else {
            // N·∫øu kh√¥ng c√≥ event, t√¨m n√∫t d·ª±a tr√™n tabName (c√°ch n√†y k√©m tin c·∫≠y h∆°n)
            document.querySelector(`#coursesSection .tab-btn[onclick*="'${tabName}'"]`)?.classList.add('active');
        }
        document.getElementById("course" + tabName.charAt(0).toUpperCase() + tabName.slice(1) + "Tab").classList.add("active");
    }

    // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã tab 'list' khi trang t·∫£i xong (n·∫øu c·∫ßn)
    document.addEventListener('DOMContentLoaded', () => {
        switchCourseTab('list'); // G·ªçi h√†m n√†y n·∫øu b·∫°n mu·ªën tab list lu√¥n active khi t·∫£i trang
    });
</script>
<<<<<<< HEAD
{{#section "styles" append=true}}
<link rel="stylesheet" href="/course-form.css" />
<script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
{{/section}}

<main class="main-content">
    <div class="container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title" id="welcomeTitle">
                H·ªá th·ªëng qu·∫£n l√Ω kh√≥a h·ªçc &amp; gi·∫£ng vi√™n
            </h1>
            <p class="welcome-text" id="welcomeText">
                Ch√†o m·ª´ng ƒë·∫øn v·ªõi h·ªá th·ªëng qu·∫£n l√Ω kh√≥a h·ªçc v√† gi·∫£ng vi√™n chuy√™n
                nghi·ªáp
            </p>
        </div>
        <!-- Course Management Section -->
        <section id="coursesSection" class="section active">
            <h2 class="section-title">üìö Qu·∫£n l√Ω kh√≥a h·ªçc</h2>
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchCourseTab('list')">
                    üìã Danh s√°ch kh√≥a h·ªçc
                </button>
                <button class="tab-btn" onclick="switchCourseTab('add')">
                    ‚ûï Th√™m kh√≥a h·ªçc
                </button>
                <button class="tab-btn" onclick="switchCourseTab('stats')">
                    üìä Th·ªëng k√™
                </button>
            </div>
            <!-- Course List Tab -->
            <div id="courseListTab" class="tab-content active">
                <div class="search-filter-bar">
                    <input type="text" class="search-input" id="courseSearchInput" placeholder="üîç T√¨m ki·∫øm kh√≥a h·ªçc..."
                        onkeyup="filterCourses()" />
                    <select class="form-select" id="categoryFilter" onchange="filterCourses()" style="width: auto">
                        <option value="*">All Categories</option>
                        {{#each global_categories}}
                        <option value="{{CatName}}">{{CatName}}</option>
                        {{/each}}
                    </select>
                    <select class="form-select" id="statusFilter" onchange="filterCourses()" style="width: auto">
                        <option value="">All State</option>
                        <option value="{{CourseStatus}}">{{CourseStatus}}</option>
                    </select>
                    <button class="btn btn-primary" onclick="showAddCourseModal()">
                        ‚ûï New Course
                    </button>
                </div>
                <div id="coursesList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>ƒêang t·∫£i danh s√°ch kh√≥a h·ªçc...</p>
                    </div>
                </div>
            </div>
            <!-- Add Course Tab -->
            <div id="courseAddTab" class="tab-content">
                <div class="form-container">
                    <form id="quickCourseForm" onsubmit="quickAddCourse(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickTitle">Course Name *</label>
                                <input type="text" class="form-input" id="quickTitle" required name="courseName" />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickImage">Image URL</label>
                                <input type="text" class="form-input" id="quickImage" placeholder="üìö"
                                    name="imageURL" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickCategory">Category *</label>
                                <select class="form-select" id="quickCategory" required name="catName"
                                    onchange="updateQuickSubcategories()">
                                    <option value="">Choose category</option>
                                    {{#each global_categories}}
                                    <option value="{{CatName}}">{{CatName}}</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickSubcategory">Sub category *</label>
                                <select class="form-select" id="quickSubcategory" required name="subCatName">
                                    <option value="">Choose sub-category</option>
                                    {{#each global_categories}}
                                    {{#each SubCategories}}
                                    <option value="{{this}}">{{this}}</option>
                                    {{/each}}
                                    {{/each}}
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickPrice">Original price (VNƒê) *</label>
                                <input type="number" class="form-input" id="quickPrice" min="0" required
                                    name="originalPrice" />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickPrice">Current price (VNƒê) *</label>
                                <input type="number" class="form-input" id="quickPrice" min="0" required
                                    name="currentPrice" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickDescription">Short description *</label>
                                <textarea class="form-textarea" id="quickDescription" rows="4" required
                                    placeholder="Describe short information about course..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickDescription">Full description *</label>
                                <textarea class="form-textarea" id="quickDescription" rows="4" required
                                    placeholder="Describe full information about course..."></textarea>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 30px">
                            <button type="submit" class="btn btn-primary" style="margin-right: 15px">
                                üíæ L∆∞u kh√≥a h·ªçc
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetQuickForm()">
                                üîÑ L√†m m·ªõi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Course Stats Tab -->
            <div id="courseStatsTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìö</div>
                        <div class="stat-number" id="totalCourses">0</div>
                        <div class="stat-label">T·ªïng kh√≥a h·ªçc</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-number" id="completedCourses">0</div>
                        <div class="stat-label">ƒê√£ ho√†n th√†nh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-number" id="incompleteCourses">0</div>
                        <div class="stat-label">Ch∆∞a ho√†n th√†nh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">T·ªïng h·ªçc vi√™n</div>
                    </div>
                </div>
                <div id="categoryStatsContainer">
                    <!-- Category statistics will be loaded here -->
                </div>
            </div>
        </section>
    </div>
</main>
<script>
    // Global variables
    let allCourses = [];
    let allInstructors = [];
    let filteredCourses = [];
    let filteredInstructors = [];

    // Default configuration
    const defaultConfig = {
        system_title: "üìö Course & Instructor Management",
        welcome_text:
            "Ch√†o m·ª´ng ƒë·∫øn v·ªõi h·ªá th·ªëng qu·∫£n l√Ω kh√≥a h·ªçc v√† gi·∫£ng vi√™n chuy√™n nghi·ªáp",
    };

    // Subcategory mapping
    const subcategoryMap = {
        IT: [
            "L·∫≠p tr√¨nh Web",
            "L·∫≠p tr√¨nh thi·∫øt b·ªã di ƒë·ªông",
            "Data Science",
            "DevOps",
            "Cybersecurity",
        ],
        Design: [
            "UI/UX Design",
            "Graphic Design",
            "Web Design",
            "Motion Graphics",
        ],
        Business: [
            "Qu·∫£n l√Ω d·ª± √°n",
            "Kh·ªüi nghi·ªáp",
            "T√†i ch√≠nh",
            "Nh√¢n s·ª±"
        ],
        Marketing: [
            "Digital Marketing",
            "Content Marketing",
            "SEO/SEM",
            "Social Media",
        ],
    };

    // Data handler for SDK
    const dataHandler = {
        onDataChanged(data) {
            allCourses = data.filter((item) => item.type === "course");
            allInstructors = data.filter((item) => item.type === "instructor");
            updateUI();
        },
    };

    // Initialize SDK and app
    async function initializeApp() {
        if (window.dataSdk) {
            const result = await window.dataSdk.init(dataHandler);
            if (result.isOk) {
                await seedInitialData();
            } else {
                console.error("Failed to initialize data SDK");
            }
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues,
            });
        }

        render(defaultConfig);
    }

    // Render function for Element SDK
    async function render(config) {
        const systemTitle = config.system_title || defaultConfig.system_title;
        const welcomeText = config.welcome_text || defaultConfig.welcome_text;

        document.getElementById("systemTitle").textContent = systemTitle;
        document.getElementById("welcomeText").textContent = welcomeText;
    }

    // Capabilities mapping
    function mapToCapabilities(config) {
        return {
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined,
        };
    }

    // Edit panel values mapping
    function mapToEditPanelValues(config) {
        return new Map([
            ["system_title", config.system_title || defaultConfig.system_title],
            ["welcome_text", config.welcome_text || defaultConfig.welcome_text],
        ]);
    }

    // Seed initial data
    async function seedInitialData() {
        if (allInstructors.length > 0) return; // Data already exists

        // Sample instructors
        const sampleInstructors = [
            {
                id: "instructor_1",
                type: "instructor",
                user_name: "Nguy·ªÖn VƒÉn Minh",
                user_email: "minh.instructor@example.com",
                bio: "Senior Python Developer v·ªõi 8+ nƒÉm kinh nghi·ªám trong ph√°t tri·ªÉn web v√† ·ª©ng d·ª•ng enterprise. ƒê√£ l√†m vi·ªác t·∫°i c√°c c√¥ng ty c√¥ng ngh·ªá h√†ng ƒë·∫ßu.",
                experience: "8",
                avatar: "üêç",
                social_links: JSON.stringify({
                    github: "https://github.com/minhpython",
                    linkedin: "https://linkedin.com/in/minhpython",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_2",
                type: "instructor",
                user_name: "Tr·∫ßn Th·ªã Lan",
                user_email: "lan.instructor@example.com",
                bio: "Frontend Architect v·ªõi chuy√™n m√¥n s√¢u v·ªÅ React.js v√† c√°c c√¥ng ngh·ªá frontend hi·ªán ƒë·∫°i. C√≥ kinh nghi·ªám mentoring team.",
                experience: "6",
                avatar: "‚ö°",
                social_links: JSON.stringify({
                    github: "https://github.com/lanreact",
                    linkedin: "https://linkedin.com/in/lanreact",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_3",
                type: "instructor",
                user_name: "L√™ VƒÉn ƒê·ª©c",
                user_email: "duc.instructor@example.com",
                bio: "Lead UX Designer v·ªõi portfolio ƒëa d·∫°ng t·ª´ startup ƒë·∫øn enterprise. Chuy√™n gia trong nghi√™n c·ª©u ng∆∞·ªùi d√πng v√† thi·∫øt k·∫ø tr·∫£i nghi·ªám.",
                experience: "7",
                avatar: "üé®",
                social_links: JSON.stringify({
                    behance: "https://behance.net/ducux",
                    linkedin: "https://linkedin.com/in/ducux",
                }),
                created_at: new Date().toISOString(),
            },
        ];

        // Sample courses
        const sampleCourses = [
            {
                id: "course_1",
                type: "course",
                title: "Advanced Python Programming",
                description:
                    "N√¢ng cao k·ªπ nƒÉng l·∫≠p tr√¨nh Python v·ªõi c√°c k·ªπ thu·∫≠t advanced v√† best practices t·ª´ c√°c chuy√™n gia h√†ng ƒë·∫ßu trong ng√†nh.",
                category: "IT",
                subcategory: "L·∫≠p tr√¨nh Web",
                instructor: "Nguy·ªÖn VƒÉn Minh",
                instructor_id: "instructor_1",
                rating: 4.9,
                reviews: 1234,
                students: 5678,
                price: 1299000,
                discount_price: 999000,
                image: "üêç",
                status: "completed",
                chapters: JSON.stringify([
                    "Gi·ªõi thi·ªáu Python Advanced",
                    "Object-Oriented Programming",
                    "Decorators v√† Generators",
                    "Async Programming",
                    "Testing v√† Debugging",
                ]),
                requirements:
                    "Ki·∫øn th·ª©c c∆° b·∫£n v·ªÅ Python\nHi·ªÉu v·ªÅ l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng",
                what_you_learn:
                    "N·∫Øm v·ªØng c√°c k·ªπ thu·∫≠t Python n√¢ng cao\nX√¢y d·ª±ng ·ª©ng d·ª•ng web v·ªõi Django/Flask\nT·ªëi ∆∞u h√≥a hi·ªáu su·∫•t code\nVi·∫øt test cases chuy√™n nghi·ªáp",
                target_audience:
                    "L·∫≠p tr√¨nh vi√™n Python c√≥ kinh nghi·ªám\nSinh vi√™n IT mu·ªën n√¢ng cao k·ªπ nƒÉng",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_2",
                type: "course",
                title: "React.js Mastery",
                description:
                    "Tr·ªü th√†nh chuy√™n gia React.js v·ªõi kh√≥a h·ªçc to√†n di·ªán t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao, bao g·ªìm hooks, context, v√† c√°c pattern hi·ªán ƒë·∫°i.",
                category: "IT",
                subcategory: "L·∫≠p tr√¨nh Web",
                instructor: "Tr·∫ßn Th·ªã Lan",
                instructor_id: "instructor_2",
                rating: 4.8,
                reviews: 987,
                students: 3456,
                price: 1599000,
                discount_price: 1199000,
                image: "‚ö°",
                status: "incomplete",
                chapters: JSON.stringify([
                    "React Fundamentals",
                    "Components v√† Props",
                    "State Management",
                    "React Hooks",
                    "Advanced Patterns",
                ]),
                requirements: "Ki·∫øn th·ª©c HTML, CSS, JavaScript\nHi·ªÉu v·ªÅ ES6+",
                what_you_learn:
                    "X√¢y d·ª±ng ·ª©ng d·ª•ng React t·ª´ ƒë·∫ßu\nQu·∫£n l√Ω state hi·ªáu qu·∫£\nS·ª≠ d·ª•ng hooks v√† context",
                target_audience: "Frontend developers\nSinh vi√™n mu·ªën h·ªçc React",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_3",
                type: "course",
                title: "UI/UX Design Complete",
                description:
                    "Kh√≥a h·ªçc thi·∫øt k·∫ø UI/UX ho√†n ch·ªânh v·ªõi c√°c d·ª± √°n th·ª±c t·∫ø v√† portfolio chuy√™n nghi·ªáp, t·ª´ research ƒë·∫øn prototype.",
                category: "Design",
                subcategory: "UI/UX Design",
                instructor: "L√™ VƒÉn ƒê·ª©c",
                instructor_id: "instructor_3",
                rating: 4.7,
                reviews: 756,
                students: 2345,
                price: 1799000,
                discount_price: 1399000,
                image: "üé®",
                status: "completed",
                chapters: JSON.stringify([
                    "Design Thinking",
                    "User Research",
                    "Wireframing",
                    "Prototyping",
                    "Visual Design",
                ]),
                requirements:
                    "Kh√¥ng c·∫ßn kinh nghi·ªám tr∆∞·ªõc\nM√°y t√≠nh c√≥ th·ªÉ ch·∫°y Figma",
                what_you_learn:
                    "Quy tr√¨nh thi·∫øt k·∫ø UX ho√†n ch·ªânh\nS·ª≠ d·ª•ng Figma chuy√™n nghi·ªáp\nT·∫°o prototype t∆∞∆°ng t√°c",
                target_audience:
                    "Ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu v·ªõi UX/UI\nGraphic designer mu·ªën chuy·ªÉn ng√†nh",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
        ];

        // Create instructors first
        for (const instructor of sampleInstructors) {
            const result = await window.dataSdk.create(instructor);
            if (!result.isOk) {
                console.error("Failed to create instructor:", instructor.user_name);
            }
        }

        // Then create courses
        for (const course of sampleCourses) {
            const result = await window.dataSdk.create(course);
            if (!result.isOk) {
                console.error("Failed to create course:", course.title);
            }
        }
    }

    // Update UI based on data
    function updateUI() {
        filteredCourses = [...allCourses];
        filteredInstructors = [...allInstructors];

        updateCoursesList();
        updateInstructorsList();
        updateCourseStats();
        updateInstructorStats();
        loadInstructorOptions();
    }

    // Section navigation
    function showSection(sectionName) {
        // Update nav links
        document
            .querySelectorAll(".nav-link")
            .forEach((link) => link.classList.remove("active"));
        event.target.classList.add("active");

        // Hide all sections
        document
            .querySelectorAll(".section")
            .forEach((section) => section.classList.remove("active"));

        // Show selected section
        document
            .getElementById(sectionName + "Section")
            .classList.add("active");
    }

    // Course Management Functions
    function switchCourseTab(tabName) {
        document
            .querySelectorAll("#coursesSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#coursesSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "course" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateCourseStats();
        }
    }

    function updateCoursesList() {
        const container = document.getElementById("coursesList");

        if (filteredCourses.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>üìö Ch∆∞a c√≥ kh√≥a h·ªçc n√†o</h3>
                    <p>H√£y th√™m kh√≥a h·ªçc ƒë·∫ßu ti√™n</p>
                    <button class="btn btn-primary" onclick="switchCourseTab('add')">‚ûï Th√™m kh√≥a h·ªçc</button>
                </div>
            `;
            return;
        }

        const coursesHtml = filteredCourses
            .map(
                (course) => `
            <div class="card">
                <div class="card-header">
                    <div class="card-avatar">${course.image}</div>
                    <div class="card-info">
                        <h3>${course.title}</h3>
                        <p>${course.category} ‚Ä¢ ${course.subcategory}</p>
                    </div>
                </div>
                <div class="card-content">
                    <p>${course.description.substring(0, 120)}...</p>
                </div>
                <div class="card-meta">
                    <div class="meta-badge">üë®‚Äçüè´ ${course.instructor}</div>
                    <div class="meta-badge">‚≠ê ${course.rating}</div>
                    <div class="meta-badge">üë• ${course.students}</div>
                    <span class="status-badge status-${course.status}">
                        ${course.status === "completed"
                        ? "Ho√†n th√†nh"
                        : course.status === "incomplete"
                            ? "Ch∆∞a ho√†n th√†nh"
                            : "B·∫£n nh√°p"
                    }
                    </span>
                </div>
                <div class="price-display">
                    <span class="price-current">${formatPrice(
                        course.discount_price || course.price
                    )}</span>
                    ${course.discount_price
                        ? `<span class="price-original">${formatPrice(
                            course.price
                        )}</span>`
                        : ""
                    }
                </div>
                <div class="card-actions">
                    <button class="btn btn-primary btn-sm" onclick="viewCourseDetail('${course.id
                    }')">üëÅÔ∏è Xem chi ti·∫øt</button>
                    <button class="btn btn-secondary btn-sm" onclick="editCourse('${course.id
                    }')">‚úèÔ∏è S·ª≠a</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteCourseConfirm('${course.id
                    }')">üóëÔ∏è X√≥a</button>
                </div>
            </div>
        `
            )
            .join("");

        container.innerHTML = `<div class="card-grid">${coursesHtml}</div>`;
    }

    function filterCourses() {
        const searchTerm = document
            .getElementById("courseSearchInput")
            .value.toLowerCase();
        const categoryFilter = document.getElementById("categoryFilter").value;
        const statusFilter = document.getElementById("statusFilter").value;

        filteredCourses = allCourses.filter((course) => {
            const matchesSearch =
                !searchTerm ||
                course.title.toLowerCase().includes(searchTerm) ||
                course.description.toLowerCase().includes(searchTerm) ||
                course.instructor.toLowerCase().includes(searchTerm);

            const matchesCategory =
                !categoryFilter || course.category === categoryFilter;
            const matchesStatus = !statusFilter || course.status === statusFilter;

            return matchesSearch && matchesCategory && matchesStatus;
        });

        updateCoursesList();
    }

    function updateQuickSubcategories() {
        const category = document.getElementById("quickCategory").value;
        const subcategorySelect = document.getElementById("quickSubcategory");

        subcategorySelect.innerHTML =
            '<option value="">Ch·ªçn chuy√™n ng√†nh</option>';

        if (category && subcategoryMap[category]) {
            subcategoryMap[category].forEach((sub) => {
                const option = document.createElement("option");
                option.value = sub;
                option.textContent = sub;
                subcategorySelect.appendChild(option);
            });
        }
    }

    function loadInstructorOptions() {
        const select = document.getElementById("quickInstructor");
        select.innerHTML = '<option value="">Ch·ªçn gi·∫£ng vi√™n</option>';

        allInstructors.forEach((instructor) => {
            const option = document.createElement("option");
            option.value = instructor.id;
            option.textContent = `${instructor.avatar} ${instructor.user_name}`;
            select.appendChild(option);
        });
    }

    async function quickAddCourse(event) {
        event.preventDefault();

        if (allCourses.length >= 999) {
            showToast("ƒê√£ ƒë·∫°t gi·ªõi h·∫°n t·ªëi ƒëa 999 kh√≥a h·ªçc!", "error");
            return;
        }

        const instructorId = document.getElementById("quickInstructor").value;
        const instructor = allInstructors.find((i) => i.id === instructorId);

        if (!instructor) {
            showToast("Vui l√≤ng ch·ªçn gi·∫£ng vi√™n!", "error");
            return;
        }

        const newCourse = {
            id: "course_" + Date.now(),
            type: "course",
            title: document.getElementById("quickTitle").value,
            description: document.getElementById("quickDescription").value,
            category: document.getElementById("quickCategory").value,
            subcategory: document.getElementById("quickSubcategory").value,
            instructor: instructor.user_name,
            instructor_id: instructorId,
            rating: 0,
            reviews: 0,
            students: 0,
            price: parseInt(document.getElementById("quickPrice").value),
            discount_price: null,
            image: document.getElementById("quickImage").value || "üìö",
            status: "draft",
            chapters: JSON.stringify(["Ch∆∞∆°ng 1: Gi·ªõi thi·ªáu"]),
            requirements: "",
            what_you_learn: "",
            target_audience: "",
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newCourse);
        if (result.isOk) {
            showToast("T·∫°o kh√≥a h·ªçc th√†nh c√¥ng!", "success");
            resetQuickForm();
            switchCourseTab("list");
        } else {
            showToast("T·∫°o kh√≥a h·ªçc th·∫•t b·∫°i!", "error");
        }
    }

    function resetQuickForm() {
        document.getElementById("quickCourseForm").reset();
        document.getElementById("quickSubcategory").innerHTML =
            '<option value="">Ch·ªçn chuy√™n ng√†nh</option>';
    }

    function updateCourseStats() {
        const totalCourses = allCourses.length;
        const completedCourses = allCourses.filter(
            (c) => c.status === "completed"
        ).length;
        const incompleteCourses = allCourses.filter(
            (c) => c.status === "incomplete"
        ).length;
        const totalStudents = allCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );

        document.getElementById("totalCourses").textContent = totalCourses;
        document.getElementById("completedCourses").textContent =
            completedCourses;
        document.getElementById("incompleteCourses").textContent =
            incompleteCourses;
        document.getElementById("totalStudents").textContent = totalStudents;

        // Category statistics
        const categoryStats = {};
        allCourses.forEach((course) => {
            if (!categoryStats[course.category]) {
                categoryStats[course.category] = {
                    total: 0,
                    completed: 0,
                    students: 0,
                };
            }
            categoryStats[course.category].total++;
            if (course.status === "completed") {
                categoryStats[course.category].completed++;
            }
            categoryStats[course.category].students += course.students;
        });

        const categoryStatsHtml = Object.entries(categoryStats)
            .map(
                ([category, stats]) => `
            <div class="category-stats">
                <h4>üìä ${category}</h4>
                <div class="category-item">
                    <span>T·ªïng kh√≥a h·ªçc:</span>
                    <span>${stats.total}</span>
                </div>
                <div class="category-item">
                    <span>ƒê√£ ho√†n th√†nh:</span>
                    <span>${stats.completed}</span>
                </div>
                <div class="category-item">
                    <span>T·ªïng h·ªçc vi√™n:</span>
                    <span>${stats.students}</span>
                </div>
            </div>
        `
            )
            .join("");

        document.getElementById("categoryStatsContainer").innerHTML =
            categoryStatsHtml;
    }

    // Instructor Management Functions
    function switchInstructorTab(tabName) {
        document
            .querySelectorAll("#instructorsSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#instructorsSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "instructor" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateInstructorStats();
        }
    }

    function updateInstructorsList() {
        const container = document.getElementById("instructorsList");

        if (filteredInstructors.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>üë®‚Äçüè´ Ch∆∞a c√≥ gi·∫£ng vi√™n n√†o</h3>
                    <p>H√£y th√™m gi·∫£ng vi√™n ƒë·∫ßu ti√™n</p>
                    <button class="btn btn-primary" onclick="switchInstructorTab('add')">‚ûï Th√™m gi·∫£ng vi√™n</button>
                </div>
            `;
            return;
        }

        const instructorsHtml = filteredInstructors
            .map((instructor) => {
                const instructorCourses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = instructorCourses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    instructorCourses.length > 0
                        ? (
                            instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                            instructorCourses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-avatar">${instructor.avatar}</div>
                        <div class="card-info">
                            <h3>${instructor.user_name}</h3>
                            <p>üìß ${instructor.user_email}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <p>${instructor.bio.substring(0, 120)}...</p>
                    </div>
                    <div class="card-meta">
                        <div class="meta-badge">üéØ ${instructor.experience
                    }+ nƒÉm</div>
                        <div class="meta-badge">üìö ${instructorCourses.length
                    } kh√≥a h·ªçc</div>
                        <div class="meta-badge">üë• ${totalStudents} h·ªçc vi√™n</div>
                        <div class="meta-badge">‚≠ê ${avgRating}</div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary btn-sm" onclick="viewInstructorDetail('${instructor.id
                    }')">üëÅÔ∏è Xem chi ti·∫øt</button>
                        <button class="btn btn-secondary btn-sm" onclick="editInstructor('${instructor.id
                    }')">‚úèÔ∏è S·ª≠a</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteInstructorConfirm('${instructor.id
                    }')">üóëÔ∏è X√≥a</button>
                    </div>
                </div>
            `;
            })
            .join("");

        container.innerHTML = `<div class="card-grid">${instructorsHtml}</div>`;
    }

    function filterInstructors() {
        const searchTerm = document
            .getElementById("instructorSearchInput")
            .value.toLowerCase();
        const experienceFilter =
            document.getElementById("experienceFilter").value;

        filteredInstructors = allInstructors.filter((instructor) => {
            const matchesSearch =
                !searchTerm ||
                instructor.user_name.toLowerCase().includes(searchTerm) ||
                instructor.user_email.toLowerCase().includes(searchTerm) ||
                instructor.bio.toLowerCase().includes(searchTerm);

            let matchesExperience = true;
            if (experienceFilter) {
                const exp = parseInt(instructor.experience);
                switch (experienceFilter) {
                    case "1-3":
                        matchesExperience = exp >= 1 && exp <= 3;
                        break;
                    case "4-7":
                        matchesExperience = exp >= 4 && exp <= 7;
                        break;
                    case "8+":
                        matchesExperience = exp >= 8;
                        break;
                }
            }

            return matchesSearch && matchesExperience;
        });

        updateInstructorsList();
    }

    async function quickAddInstructor(event) {
        event.preventDefault();

        if (allInstructors.length >= 999) {
            showToast("ƒê√£ ƒë·∫°t gi·ªõi h·∫°n t·ªëi ƒëa 999 gi·∫£ng vi√™n!", "error");
            return;
        }

        const email = document.getElementById("quickInstructorEmail").value;
        const existingInstructor = allInstructors.find(
            (i) => i.user_email === email
        );

        if (existingInstructor) {
            showToast("Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!", "error");
            return;
        }

        const socialLinks = {
            github: document.getElementById("quickGithub").value,
            linkedin: document.getElementById("quickLinkedin").value,
        };

        const newInstructor = {
            id: "instructor_" + Date.now(),
            type: "instructor",
            user_name: document.getElementById("quickInstructorName").value,
            user_email: email,
            bio: document.getElementById("quickBio").value,
            experience: document.getElementById("quickExperience").value,
            avatar: document.getElementById("quickAvatar").value,
            social_links: JSON.stringify(socialLinks),
            created_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newInstructor);
        if (result.isOk) {
            showToast("Th√™m gi·∫£ng vi√™n th√†nh c√¥ng!", "success");
            resetInstructorForm();
            switchInstructorTab("list");
        } else {
            showToast("Th√™m gi·∫£ng vi√™n th·∫•t b·∫°i!", "error");
        }
    }

    function resetInstructorForm() {
        document.getElementById("quickInstructorForm").reset();
    }

    function updateInstructorStats() {
        const totalInstructors = allInstructors.length;
        const avgRating =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce((sum, instructor) => {
                        const courses = allCourses.filter(
                            (c) => c.instructor_id === instructor.id
                        );
                        const instructorAvgRating =
                            courses.length > 0
                                ? courses.reduce((sum, c) => sum + c.rating, 0) /
                                courses.length
                                : 0;
                        return sum + instructorAvgRating;
                    }, 0) / allInstructors.length
                ).toFixed(1)
                : 0;

        const avgCoursesPerInstructor =
            totalInstructors > 0
                ? (allCourses.length / totalInstructors).toFixed(1)
                : 0;

        const avgExperience =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce(
                        (sum, i) => sum + parseInt(i.experience),
                        0
                    ) / allInstructors.length
                ).toFixed(1)
                : 0;

        document.getElementById("totalInstructors").textContent =
            totalInstructors;
        document.getElementById("avgInstructorRating").textContent = avgRating;
        document.getElementById("avgCoursesPerInstructor").textContent =
            avgCoursesPerInstructor;
        document.getElementById("avgExperience").textContent = avgExperience;

        // Detailed instructor statistics
        const instructorStatsHtml = allInstructors
            .map((instructor) => {
                const courses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = courses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    courses.length > 0
                        ? (
                            courses.reduce((sum, c) => sum + c.rating, 0) /
                            courses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="category-stats">
                    <h4>${instructor.avatar} ${instructor.user_name}</h4>
                    <div class="category-item">
                        <span>S·ªë kh√≥a h·ªçc:</span>
                        <span>${courses.length}</span>
                    </div>
                    <div class="category-item">
                        <span>T·ªïng h·ªçc vi√™n:</span>
                        <span>${totalStudents}</span>
                    </div>
                    <div class="category-item">
                        <span>ƒê√°nh gi√° trung b√¨nh:</span>
                        <span>${avgRating}</span>
                    </div>
                    <div class="category-item">
                        <span>Kinh nghi·ªám:</span>
                        <span>${instructor.experience} nƒÉm</span>
                    </div>
                </div>
            `;
            })
            .join("");

        document.getElementById("instructorStatsDetails").innerHTML =
            instructorStatsHtml;
    }

    // Detail view functions
    function viewCourseDetail(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        const instructor = allInstructors.find(
            (i) => i.id === course.instructor_id
        );
        const chapters = JSON.parse(course.chapters || "[]");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin-right: 20px;">
                        ${course.image}
                    </div>
                    <div>
                        <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${course.title
            }</h2>
                        <p style="color: var(--light-silver); margin: 0;">${course.category
            } ‚Ä¢ ${course.subcategory}</p>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìã M√¥ t·∫£</h4>
                    <p style="color: white; line-height: 1.6;">${course.description
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üí∞ Th√¥ng tin gi√°</h4>
                        <div style="color: white;">
                            <div>Gi√° g·ªëc: ${formatPrice(course.price)}</div>
                            ${course.discount_price
                ? `<div>Gi√° khuy·∫øn m√£i: ${formatPrice(
                    course.discount_price
                )}</div>`
                : ""
            }
                        </div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìä Th·ªëng k√™</h4>
                        <div style="color: white;">
                            <div>‚≠ê ${course.rating} (${course.reviews
            } ƒë√°nh gi√°)</div>
                            <div>üë• ${course.students} h·ªçc vi√™n</div>
                            <div>üìÖ ${new Date(
                course.created_at
            ).toLocaleDateString("vi-VN")}</div>
                        </div>
                    </div>
                </div>

                ${instructor
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üë®‚Äçüè´ Gi·∫£ng vi√™n</h4>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-right: 15px;">
                                ${instructor.avatar}
                            </div>
                            <div>
                                <div style="color: white; font-weight: bold;">${instructor.user_name}</div>
                                <div style="color: var(--light-silver);">${instructor.experience}+ nƒÉm kinh nghi·ªám</div>
                            </div>
                        </div>
                    </div>
                `
                : ""
            }

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìö Ch∆∞∆°ng tr√¨nh h·ªçc</h4>
                    <div>
                        ${chapters
                .map(
                    (chapter, index) => `
                            <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; color: white;">
                                Ch∆∞∆°ng ${index + 1}: ${chapter}
                            </div>
                        `
                )
                .join("")}
                    </div>
                </div>
            </div>
        `;

        document.getElementById("courseModalContent").innerHTML = detailHtml;
        document.getElementById("courseModalTitle").textContent = course.title;
        document.getElementById("courseModal").classList.add("show");
    }

    function viewInstructorDetail(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        const totalStudents = instructorCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );
        const avgRating =
            instructorCourses.length > 0
                ? (
                    instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                    instructorCourses.length
                ).toFixed(1)
                : 0;

        const socialLinks = JSON.parse(instructor.social_links || "{}");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 120px; height: 120px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px;">
                        ${instructor.avatar}
                    </div>
                    <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${instructor.user_name
            }</h2>
                    <p style="color: var(--light-silver); margin: 0;">üìß ${instructor.user_email
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructorCourses.length
            }</div>
                        <div style="color: white; font-size: 0.9rem;">Kh√≥a h·ªçc</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${totalStudents}</div>
                        <div style="color: white; font-size: 0.9rem;">H·ªçc vi√™n</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${avgRating}</div>
                        <div style="color: white; font-size: 0.9rem;">ƒê√°nh gi√° TB</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructor.experience
            }</div>
                        <div style="color: white; font-size: 0.9rem;">NƒÉm KN</div>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìù Gi·ªõi thi·ªáu</h4>
                    <p style="color: white; line-height: 1.6;">${instructor.bio
            }</p>
                </div>

                ${Object.keys(socialLinks).length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üîó Li√™n k·∫øt</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            ${socialLinks.github
                    ? `<a href="${socialLinks.github}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">üêô GitHub</a>`
                    : ""
                }
                            ${socialLinks.linkedin
                    ? `<a href="${socialLinks.linkedin}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">üíº LinkedIn</a>`
                    : ""
                }
                            ${socialLinks.behance
                    ? `<a href="${socialLinks.behance}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">üé® Behance</a>`
                    : ""
                }
                        </div>
                    </div>
                `
                : ""
            }

                ${instructorCourses.length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìö Kh√≥a h·ªçc gi·∫£ng d·∫°y</h4>
                        <div>
                            ${instructorCourses
                    .map(
                        (course) => `
                                <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: var(--accent-gold); font-weight: bold;">${course.title}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.category} ‚Ä¢ ${course.subcategory}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: white;">‚≠ê ${course.rating}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.students} h·ªçc vi√™n</div>
                                    </div>
                                </div>
                            `
                    )
                    .join("")}
                        </div>
                    </div>
                `
                : ""
            }
            </div>
        `;

        document.getElementById("instructorModalContent").innerHTML =
            detailHtml;
        document.getElementById("instructorModalTitle").textContent =
            instructor.user_name;
        document.getElementById("instructorModal").classList.add("show");
    }

    // Delete confirmation functions
    async function deleteCourseConfirm(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√≥a h·ªçc "${course.title}"?`)) {
            const result = await window.dataSdk.delete(course);
            if (result.isOk) {
                showToast("X√≥a kh√≥a h·ªçc th√†nh c√¥ng!", "success");
            } else {
                showToast("X√≥a kh√≥a h·ªçc th·∫•t b·∫°i!", "error");
            }
        }
    }

    async function deleteInstructorConfirm(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        if (instructorCourses.length > 0) {
            showToast("Kh√¥ng th·ªÉ x√≥a gi·∫£ng vi√™n ƒëang c√≥ kh√≥a h·ªçc!", "error");
            return;
        }

        if (
            confirm(
                `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a gi·∫£ng vi√™n "${instructor.user_name}"?`
            )
        ) {
            const result = await window.dataSdk.delete(instructor);
            if (result.isOk) {
                showToast("X√≥a gi·∫£ng vi√™n th√†nh c√¥ng!", "success");
            } else {
                showToast("X√≥a gi·∫£ng vi√™n th·∫•t b·∫°i!", "error");
            }
        }
    }

    // Modal functions
    function closeCourseModal() {
        document.getElementById("courseModal").classList.remove("show");
    }

    function closeInstructorModal() {
        document.getElementById("instructorModal").classList.remove("show");
    }

    // Utility functions
    function formatPrice(price) {
        return new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
        }).format(price);
    }

    function showToast(message, type = "info") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => {
            toast.classList.add("show");
        }, 100);

        setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    // Initialize app when page loads
    document.addEventListener("DOMContentLoaded", initializeApp);
</script>
<script>
    (function () {
        function c() {
            var b = a.contentDocument || a.contentWindow.document;
            if (b) {
                var d = b.createElement("script");
                d.innerHTML =
                    "window.__CF$cv$params={r:'9929e89230c5fd8b',t:'MTc2MTE0NTY5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
                b.getElementsByTagName("head")[0].appendChild(d);
            }
        }
        if (document.body) {
            var a = document.createElement("iframe");
            a.height = 1;
            a.width = 1;
            a.style.position = "absolute";
            a.style.top = 0;
            a.style.left = 0;
            a.style.border = "none";
            a.style.visibility = "hidden";
            document.body.appendChild(a);
            if ("loading" !== document.readyState) c();
            else if (window.addEventListener)
                document.addEventListener("DOMContentLoaded", c);
            else {
                var e = document.onreadystatechange || function () { };
                document.onreadystatechange = function (b) {
                    e(b);
                    "loading" !== document.readyState &&
                        ((document.onreadystatechange = e), c());
                };
            }
        }
    })();
=======
{{#section "styles" append=true}}
<link rel="stylesheet" href="/course-form.css" />
<script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
{{/section}}

<main class="main-content">
    <div class="container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title" id="welcomeTitle">
                H·ªá th·ªëng qu·∫£n l√Ω kh√≥a h·ªçc &amp; gi·∫£ng vi√™n
            </h1>
            <p class="welcome-text" id="welcomeText">
                Ch√†o m·ª´ng ƒë·∫øn v·ªõi h·ªá th·ªëng qu·∫£n l√Ω kh√≥a h·ªçc v√† gi·∫£ng vi√™n chuy√™n
                nghi·ªáp
            </p>
        </div>
        <!-- Course Management Section -->
        <section id="coursesSection" class="section active">
            <h2 class="section-title">üìö Qu·∫£n l√Ω kh√≥a h·ªçc</h2>
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchCourseTab('list')">
                    üìã Danh s√°ch kh√≥a h·ªçc
                </button>
                <button class="tab-btn" onclick="switchCourseTab('add')">
                    ‚ûï Th√™m kh√≥a h·ªçc
                </button>
                <button class="tab-btn" onclick="switchCourseTab('stats')">
                    üìä Th·ªëng k√™
                </button>
            </div>
            <!-- Course List Tab -->
            <div id="courseListTab" class="tab-content active">
                <div class="search-filter-bar">
                    <input type="text" class="search-input" id="courseSearchInput" placeholder="üîç T√¨m ki·∫øm kh√≥a h·ªçc..."
                        onkeyup="filterCourses()" />
                    <select class="form-select" id="categoryFilter" onchange="filterCourses()" style="width: auto">
                        <option value="">T·∫•t c·∫£ lƒ©nh v·ª±c</option>
                        <option value="IT">C√¥ng ngh·ªá th√¥ng tin</option>
                        <option value="Design">Thi·∫øt k·∫ø</option>
                        <option value="Business">Kinh doanh</option>
                        <option value="Marketing">Marketing</option>
                    </select>
                    <select class="form-select" id="statusFilter" onchange="filterCourses()" style="width: auto">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="completed">Ho√†n th√†nh</option>
                        <option value="incomplete">Ch∆∞a ho√†n th√†nh</option>
                        <option value="draft">B·∫£n nh√°p</option>
                    </select>
                    <button class="btn btn-primary" onclick="showAddCourseModal()">
                        ‚ûï Th√™m kh√≥a h·ªçc
                    </button>
                </div>
                <div id="coursesList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>ƒêang t·∫£i danh s√°ch kh√≥a h·ªçc...</p>
                    </div>
                </div>
            </div>
            <!-- Add Course Tab -->
            <div id="courseAddTab" class="tab-content">
                <div class="form-container">
                    <h3 style="
                color: var(--accent-gold);
                margin-bottom: 25px;
                text-align: center;
            ">
                        ‚ûï Th√™m kh√≥a h·ªçc m·ªõi
                    </h3>
                    <form id="quickCourseForm" onsubmit="quickAddCourse(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickTitle">T√™n kh√≥a h·ªçc *</label>
                                <input type="text" class="form-input" id="quickTitle" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickImage">Icon kh√≥a h·ªçc</label>
                                <input type="text" class="form-input" id="quickImage" placeholder="üìö" maxlength="2" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickCategory">Lƒ©nh v·ª±c *</label>
                                <select class="form-select" id="quickCategory" required
                                    onchange="updateQuickSubcategories()">
                                    <option value="">Ch·ªçn lƒ©nh v·ª±c</option>
                                    <option value="IT">C√¥ng ngh·ªá th√¥ng tin</option>
                                    <option value="Design">Thi·∫øt k·∫ø</option>
                                    <option value="Business">Kinh doanh</option>
                                    <option value="Marketing">Marketing</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickSubcategory">Chuy√™n ng√†nh *</label>
                                <select class="form-select" id="quickSubcategory" required>
                                    <option value="">Ch·ªçn chuy√™n ng√†nh</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="quickPrice">Gi√° kh√≥a h·ªçc (VNƒê) *</label>
                                <input type="number" class="form-input" id="quickPrice" min="0" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="quickInstructor">Gi·∫£ng vi√™n *</label>
                                <select class="form-select" id="quickInstructor" required>
                                    <option value="">Ch·ªçn gi·∫£ng vi√™n</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row full">
                            <div class="form-group">
                                <label class="form-label" for="quickDescription">M√¥ t·∫£ kh√≥a h·ªçc *</label>
                                <textarea class="form-textarea" id="quickDescription" rows="4" required
                                    placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ kh√≥a h·ªçc..."></textarea>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 30px">
                            <button type="submit" class="btn btn-primary" style="margin-right: 15px">
                                üíæ L∆∞u kh√≥a h·ªçc
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetQuickForm()">
                                üîÑ L√†m m·ªõi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Course Stats Tab -->
            <div id="courseStatsTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìö</div>
                        <div class="stat-number" id="totalCourses">0</div>
                        <div class="stat-label">T·ªïng kh√≥a h·ªçc</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-number" id="completedCourses">0</div>
                        <div class="stat-label">ƒê√£ ho√†n th√†nh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-number" id="incompleteCourses">0</div>
                        <div class="stat-label">Ch∆∞a ho√†n th√†nh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">T·ªïng h·ªçc vi√™n</div>
                    </div>
                </div>
                <div id="categoryStatsContainer">
                    <!-- Category statistics will be loaded here -->
                </div>
            </div>
        </section>
    </div>
</main>
<script>
    // Global variables
    let allCourses = [];
    let allInstructors = [];
    let filteredCourses = [];
    let filteredInstructors = [];

    // Default configuration
    const defaultConfig = {
        system_title: "üìö Course & Instructor Management",
        welcome_text:
            "Ch√†o m·ª´ng ƒë·∫øn v·ªõi h·ªá th·ªëng qu·∫£n l√Ω kh√≥a h·ªçc v√† gi·∫£ng vi√™n chuy√™n nghi·ªáp",
    };

    // Subcategory mapping
    const subcategoryMap = {
        IT: [
            "L·∫≠p tr√¨nh Web",
            "L·∫≠p tr√¨nh thi·∫øt b·ªã di ƒë·ªông",
            "Data Science",
            "DevOps",
            "Cybersecurity",
        ],
        Design: [
            "UI/UX Design",
            "Graphic Design",
            "Web Design",
            "Motion Graphics",
        ],
        Business: ["Qu·∫£n l√Ω d·ª± √°n", "Kh·ªüi nghi·ªáp", "T√†i ch√≠nh", "Nh√¢n s·ª±"],
        Marketing: [
            "Digital Marketing",
            "Content Marketing",
            "SEO/SEM",
            "Social Media",
        ],
    };

    // Data handler for SDK
    const dataHandler = {
        onDataChanged(data) {
            allCourses = data.filter((item) => item.type === "course");
            allInstructors = data.filter((item) => item.type === "instructor");
            updateUI();
        },
    };

    // Initialize SDK and app
    async function initializeApp() {
        if (window.dataSdk) {
            const result = await window.dataSdk.init(dataHandler);
            if (result.isOk) {
                await seedInitialData();
            } else {
                console.error("Failed to initialize data SDK");
            }
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues,
            });
        }

        render(defaultConfig);
    }

    // Render function for Element SDK
    async function render(config) {
        const systemTitle = config.system_title || defaultConfig.system_title;
        const welcomeText = config.welcome_text || defaultConfig.welcome_text;

        document.getElementById("systemTitle").textContent = systemTitle;
        document.getElementById("welcomeText").textContent = welcomeText;
    }

    // Capabilities mapping
    function mapToCapabilities(config) {
        return {
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined,
        };
    }

    // Edit panel values mapping
    function mapToEditPanelValues(config) {
        return new Map([
            ["system_title", config.system_title || defaultConfig.system_title],
            ["welcome_text", config.welcome_text || defaultConfig.welcome_text],
        ]);
    }

    // Seed initial data
    async function seedInitialData() {
        if (allInstructors.length > 0) return; // Data already exists

        // Sample instructors
        const sampleInstructors = [
            {
                id: "instructor_1",
                type: "instructor",
                user_name: "Nguy·ªÖn VƒÉn Minh",
                user_email: "minh.instructor@example.com",
                bio: "Senior Python Developer v·ªõi 8+ nƒÉm kinh nghi·ªám trong ph√°t tri·ªÉn web v√† ·ª©ng d·ª•ng enterprise. ƒê√£ l√†m vi·ªác t·∫°i c√°c c√¥ng ty c√¥ng ngh·ªá h√†ng ƒë·∫ßu.",
                experience: "8",
                avatar: "üêç",
                social_links: JSON.stringify({
                    github: "https://github.com/minhpython",
                    linkedin: "https://linkedin.com/in/minhpython",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_2",
                type: "instructor",
                user_name: "Tr·∫ßn Th·ªã Lan",
                user_email: "lan.instructor@example.com",
                bio: "Frontend Architect v·ªõi chuy√™n m√¥n s√¢u v·ªÅ React.js v√† c√°c c√¥ng ngh·ªá frontend hi·ªán ƒë·∫°i. C√≥ kinh nghi·ªám mentoring team.",
                experience: "6",
                avatar: "‚ö°",
                social_links: JSON.stringify({
                    github: "https://github.com/lanreact",
                    linkedin: "https://linkedin.com/in/lanreact",
                }),
                created_at: new Date().toISOString(),
            },
            {
                id: "instructor_3",
                type: "instructor",
                user_name: "L√™ VƒÉn ƒê·ª©c",
                user_email: "duc.instructor@example.com",
                bio: "Lead UX Designer v·ªõi portfolio ƒëa d·∫°ng t·ª´ startup ƒë·∫øn enterprise. Chuy√™n gia trong nghi√™n c·ª©u ng∆∞·ªùi d√πng v√† thi·∫øt k·∫ø tr·∫£i nghi·ªám.",
                experience: "7",
                avatar: "üé®",
                social_links: JSON.stringify({
                    behance: "https://behance.net/ducux",
                    linkedin: "https://linkedin.com/in/ducux",
                }),
                created_at: new Date().toISOString(),
            },
        ];

        // Sample courses
        const sampleCourses = [
            {
                id: "course_1",
                type: "course",
                title: "Advanced Python Programming",
                description:
                    "N√¢ng cao k·ªπ nƒÉng l·∫≠p tr√¨nh Python v·ªõi c√°c k·ªπ thu·∫≠t advanced v√† best practices t·ª´ c√°c chuy√™n gia h√†ng ƒë·∫ßu trong ng√†nh.",
                category: "IT",
                subcategory: "L·∫≠p tr√¨nh Web",
                instructor: "Nguy·ªÖn VƒÉn Minh",
                instructor_id: "instructor_1",
                rating: 4.9,
                reviews: 1234,
                students: 5678,
                price: 1299000,
                discount_price: 999000,
                image: "üêç",
                status: "completed",
                chapters: JSON.stringify([
                    "Gi·ªõi thi·ªáu Python Advanced",
                    "Object-Oriented Programming",
                    "Decorators v√† Generators",
                    "Async Programming",
                    "Testing v√† Debugging",
                ]),
                requirements:
                    "Ki·∫øn th·ª©c c∆° b·∫£n v·ªÅ Python\nHi·ªÉu v·ªÅ l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng",
                what_you_learn:
                    "N·∫Øm v·ªØng c√°c k·ªπ thu·∫≠t Python n√¢ng cao\nX√¢y d·ª±ng ·ª©ng d·ª•ng web v·ªõi Django/Flask\nT·ªëi ∆∞u h√≥a hi·ªáu su·∫•t code\nVi·∫øt test cases chuy√™n nghi·ªáp",
                target_audience:
                    "L·∫≠p tr√¨nh vi√™n Python c√≥ kinh nghi·ªám\nSinh vi√™n IT mu·ªën n√¢ng cao k·ªπ nƒÉng",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_2",
                type: "course",
                title: "React.js Mastery",
                description:
                    "Tr·ªü th√†nh chuy√™n gia React.js v·ªõi kh√≥a h·ªçc to√†n di·ªán t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao, bao g·ªìm hooks, context, v√† c√°c pattern hi·ªán ƒë·∫°i.",
                category: "IT",
                subcategory: "L·∫≠p tr√¨nh Web",
                instructor: "Tr·∫ßn Th·ªã Lan",
                instructor_id: "instructor_2",
                rating: 4.8,
                reviews: 987,
                students: 3456,
                price: 1599000,
                discount_price: 1199000,
                image: "‚ö°",
                status: "incomplete",
                chapters: JSON.stringify([
                    "React Fundamentals",
                    "Components v√† Props",
                    "State Management",
                    "React Hooks",
                    "Advanced Patterns",
                ]),
                requirements: "Ki·∫øn th·ª©c HTML, CSS, JavaScript\nHi·ªÉu v·ªÅ ES6+",
                what_you_learn:
                    "X√¢y d·ª±ng ·ª©ng d·ª•ng React t·ª´ ƒë·∫ßu\nQu·∫£n l√Ω state hi·ªáu qu·∫£\nS·ª≠ d·ª•ng hooks v√† context",
                target_audience: "Frontend developers\nSinh vi√™n mu·ªën h·ªçc React",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
            {
                id: "course_3",
                type: "course",
                title: "UI/UX Design Complete",
                description:
                    "Kh√≥a h·ªçc thi·∫øt k·∫ø UI/UX ho√†n ch·ªânh v·ªõi c√°c d·ª± √°n th·ª±c t·∫ø v√† portfolio chuy√™n nghi·ªáp, t·ª´ research ƒë·∫øn prototype.",
                category: "Design",
                subcategory: "UI/UX Design",
                instructor: "L√™ VƒÉn ƒê·ª©c",
                instructor_id: "instructor_3",
                rating: 4.7,
                reviews: 756,
                students: 2345,
                price: 1799000,
                discount_price: 1399000,
                image: "üé®",
                status: "completed",
                chapters: JSON.stringify([
                    "Design Thinking",
                    "User Research",
                    "Wireframing",
                    "Prototyping",
                    "Visual Design",
                ]),
                requirements:
                    "Kh√¥ng c·∫ßn kinh nghi·ªám tr∆∞·ªõc\nM√°y t√≠nh c√≥ th·ªÉ ch·∫°y Figma",
                what_you_learn:
                    "Quy tr√¨nh thi·∫øt k·∫ø UX ho√†n ch·ªânh\nS·ª≠ d·ª•ng Figma chuy√™n nghi·ªáp\nT·∫°o prototype t∆∞∆°ng t√°c",
                target_audience:
                    "Ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu v·ªõi UX/UI\nGraphic designer mu·ªën chuy·ªÉn ng√†nh",
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            },
        ];

        // Create instructors first
        for (const instructor of sampleInstructors) {
            const result = await window.dataSdk.create(instructor);
            if (!result.isOk) {
                console.error("Failed to create instructor:", instructor.user_name);
            }
        }

        // Then create courses
        for (const course of sampleCourses) {
            const result = await window.dataSdk.create(course);
            if (!result.isOk) {
                console.error("Failed to create course:", course.title);
            }
        }
    }

    // Update UI based on data
    function updateUI() {
        filteredCourses = [...allCourses];
        filteredInstructors = [...allInstructors];

        updateCoursesList();
        updateInstructorsList();
        updateCourseStats();
        updateInstructorStats();
        loadInstructorOptions();
    }

    // Section navigation
    function showSection(sectionName) {
        // Update nav links
        document
            .querySelectorAll(".nav-link")
            .forEach((link) => link.classList.remove("active"));
        event.target.classList.add("active");

        // Hide all sections
        document
            .querySelectorAll(".section")
            .forEach((section) => section.classList.remove("active"));

        // Show selected section
        document
            .getElementById(sectionName + "Section")
            .classList.add("active");
    }

    // Course Management Functions
    function switchCourseTab(tabName) {
        document
            .querySelectorAll("#coursesSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#coursesSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "course" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateCourseStats();
        }
    }

    function updateCoursesList() {
        const container = document.getElementById("coursesList");

        if (filteredCourses.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>üìö Ch∆∞a c√≥ kh√≥a h·ªçc n√†o</h3>
                    <p>H√£y th√™m kh√≥a h·ªçc ƒë·∫ßu ti√™n</p>
                    <button class="btn btn-primary" onclick="switchCourseTab('add')">‚ûï Th√™m kh√≥a h·ªçc</button>
                </div>
            `;
            return;
        }

        const coursesHtml = filteredCourses
            .map(
                (course) => `
            <div class="card">
                <div class="card-header">
                    <div class="card-avatar">${course.image}</div>
                    <div class="card-info">
                        <h3>${course.title}</h3>
                        <p>${course.category} ‚Ä¢ ${course.subcategory}</p>
                    </div>
                </div>
                <div class="card-content">
                    <p>${course.description.substring(0, 120)}...</p>
                </div>
                <div class="card-meta">
                    <div class="meta-badge">üë®‚Äçüè´ ${course.instructor}</div>
                    <div class="meta-badge">‚≠ê ${course.rating}</div>
                    <div class="meta-badge">üë• ${course.students}</div>
                    <span class="status-badge status-${course.status}">
                        ${course.status === "completed"
                        ? "Ho√†n th√†nh"
                        : course.status === "incomplete"
                            ? "Ch∆∞a ho√†n th√†nh"
                            : "B·∫£n nh√°p"
                    }
                    </span>
                </div>
                <div class="price-display">
                    <span class="price-current">${formatPrice(
                        course.discount_price || course.price
                    )}</span>
                    ${course.discount_price
                        ? `<span class="price-original">${formatPrice(
                            course.price
                        )}</span>`
                        : ""
                    }
                </div>
                <div class="card-actions">
                    <button class="btn btn-primary btn-sm" onclick="viewCourseDetail('${course.id
                    }')">üëÅÔ∏è Xem chi ti·∫øt</button>
                    <button class="btn btn-secondary btn-sm" onclick="editCourse('${course.id
                    }')">‚úèÔ∏è S·ª≠a</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteCourseConfirm('${course.id
                    }')">üóëÔ∏è X√≥a</button>
                </div>
            </div>
        `
            )
            .join("");

        container.innerHTML = `<div class="card-grid">${coursesHtml}</div>`;
    }

    function filterCourses() {
        const searchTerm = document
            .getElementById("courseSearchInput")
            .value.toLowerCase();
        const categoryFilter = document.getElementById("categoryFilter").value;
        const statusFilter = document.getElementById("statusFilter").value;

        filteredCourses = allCourses.filter((course) => {
            const matchesSearch =
                !searchTerm ||
                course.title.toLowerCase().includes(searchTerm) ||
                course.description.toLowerCase().includes(searchTerm) ||
                course.instructor.toLowerCase().includes(searchTerm);

            const matchesCategory =
                !categoryFilter || course.category === categoryFilter;
            const matchesStatus = !statusFilter || course.status === statusFilter;

            return matchesSearch && matchesCategory && matchesStatus;
        });

        updateCoursesList();
    }

    function updateQuickSubcategories() {
        const category = document.getElementById("quickCategory").value;
        const subcategorySelect = document.getElementById("quickSubcategory");

        subcategorySelect.innerHTML =
            '<option value="">Ch·ªçn chuy√™n ng√†nh</option>';

        if (category && subcategoryMap[category]) {
            subcategoryMap[category].forEach((sub) => {
                const option = document.createElement("option");
                option.value = sub;
                option.textContent = sub;
                subcategorySelect.appendChild(option);
            });
        }
    }

    function loadInstructorOptions() {
        const select = document.getElementById("quickInstructor");
        select.innerHTML = '<option value="">Ch·ªçn gi·∫£ng vi√™n</option>';

        allInstructors.forEach((instructor) => {
            const option = document.createElement("option");
            option.value = instructor.id;
            option.textContent = `${instructor.avatar} ${instructor.user_name}`;
            select.appendChild(option);
        });
    }

    async function quickAddCourse(event) {
        event.preventDefault();

        if (allCourses.length >= 999) {
            showToast("ƒê√£ ƒë·∫°t gi·ªõi h·∫°n t·ªëi ƒëa 999 kh√≥a h·ªçc!", "error");
            return;
        }

        const instructorId = document.getElementById("quickInstructor").value;
        const instructor = allInstructors.find((i) => i.id === instructorId);

        if (!instructor) {
            showToast("Vui l√≤ng ch·ªçn gi·∫£ng vi√™n!", "error");
            return;
        }

        const newCourse = {
            id: "course_" + Date.now(),
            type: "course",
            title: document.getElementById("quickTitle").value,
            description: document.getElementById("quickDescription").value,
            category: document.getElementById("quickCategory").value,
            subcategory: document.getElementById("quickSubcategory").value,
            instructor: instructor.user_name,
            instructor_id: instructorId,
            rating: 0,
            reviews: 0,
            students: 0,
            price: parseInt(document.getElementById("quickPrice").value),
            discount_price: null,
            image: document.getElementById("quickImage").value || "üìö",
            status: "draft",
            chapters: JSON.stringify(["Ch∆∞∆°ng 1: Gi·ªõi thi·ªáu"]),
            requirements: "",
            what_you_learn: "",
            target_audience: "",
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newCourse);
        if (result.isOk) {
            showToast("T·∫°o kh√≥a h·ªçc th√†nh c√¥ng!", "success");
            resetQuickForm();
            switchCourseTab("list");
        } else {
            showToast("T·∫°o kh√≥a h·ªçc th·∫•t b·∫°i!", "error");
        }
    }

    function resetQuickForm() {
        document.getElementById("quickCourseForm").reset();
        document.getElementById("quickSubcategory").innerHTML =
            '<option value="">Ch·ªçn chuy√™n ng√†nh</option>';
    }

    function updateCourseStats() {
        const totalCourses = allCourses.length;
        const completedCourses = allCourses.filter(
            (c) => c.status === "completed"
        ).length;
        const incompleteCourses = allCourses.filter(
            (c) => c.status === "incomplete"
        ).length;
        const totalStudents = allCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );

        document.getElementById("totalCourses").textContent = totalCourses;
        document.getElementById("completedCourses").textContent =
            completedCourses;
        document.getElementById("incompleteCourses").textContent =
            incompleteCourses;
        document.getElementById("totalStudents").textContent = totalStudents;

        // Category statistics
        const categoryStats = {};
        allCourses.forEach((course) => {
            if (!categoryStats[course.category]) {
                categoryStats[course.category] = {
                    total: 0,
                    completed: 0,
                    students: 0,
                };
            }
            categoryStats[course.category].total++;
            if (course.status === "completed") {
                categoryStats[course.category].completed++;
            }
            categoryStats[course.category].students += course.students;
        });

        const categoryStatsHtml = Object.entries(categoryStats)
            .map(
                ([category, stats]) => `
            <div class="category-stats">
                <h4>üìä ${category}</h4>
                <div class="category-item">
                    <span>T·ªïng kh√≥a h·ªçc:</span>
                    <span>${stats.total}</span>
                </div>
                <div class="category-item">
                    <span>ƒê√£ ho√†n th√†nh:</span>
                    <span>${stats.completed}</span>
                </div>
                <div class="category-item">
                    <span>T·ªïng h·ªçc vi√™n:</span>
                    <span>${stats.students}</span>
                </div>
            </div>
        `
            )
            .join("");

        document.getElementById("categoryStatsContainer").innerHTML =
            categoryStatsHtml;
    }

    // Instructor Management Functions
    function switchInstructorTab(tabName) {
        document
            .querySelectorAll("#instructorsSection .tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        document
            .querySelectorAll("#instructorsSection .tab-content")
            .forEach((content) => content.classList.remove("active"));

        event.target.classList.add("active");
        document
            .getElementById(
                "instructor" +
                tabName.charAt(0).toUpperCase() +
                tabName.slice(1) +
                "Tab"
            )
            .classList.add("active");

        if (tabName === "stats") {
            updateInstructorStats();
        }
    }

    function updateInstructorsList() {
        const container = document.getElementById("instructorsList");

        if (filteredInstructors.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>üë®‚Äçüè´ Ch∆∞a c√≥ gi·∫£ng vi√™n n√†o</h3>
                    <p>H√£y th√™m gi·∫£ng vi√™n ƒë·∫ßu ti√™n</p>
                    <button class="btn btn-primary" onclick="switchInstructorTab('add')">‚ûï Th√™m gi·∫£ng vi√™n</button>
                </div>
            `;
            return;
        }

        const instructorsHtml = filteredInstructors
            .map((instructor) => {
                const instructorCourses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = instructorCourses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    instructorCourses.length > 0
                        ? (
                            instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                            instructorCourses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-avatar">${instructor.avatar}</div>
                        <div class="card-info">
                            <h3>${instructor.user_name}</h3>
                            <p>üìß ${instructor.user_email}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <p>${instructor.bio.substring(0, 120)}...</p>
                    </div>
                    <div class="card-meta">
                        <div class="meta-badge">üéØ ${instructor.experience
                    }+ nƒÉm</div>
                        <div class="meta-badge">üìö ${instructorCourses.length
                    } kh√≥a h·ªçc</div>
                        <div class="meta-badge">üë• ${totalStudents} h·ªçc vi√™n</div>
                        <div class="meta-badge">‚≠ê ${avgRating}</div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary btn-sm" onclick="viewInstructorDetail('${instructor.id
                    }')">üëÅÔ∏è Xem chi ti·∫øt</button>
                        <button class="btn btn-secondary btn-sm" onclick="editInstructor('${instructor.id
                    }')">‚úèÔ∏è S·ª≠a</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteInstructorConfirm('${instructor.id
                    }')">üóëÔ∏è X√≥a</button>
                    </div>
                </div>
            `;
            })
            .join("");

        container.innerHTML = `<div class="card-grid">${instructorsHtml}</div>`;
    }

    function filterInstructors() {
        const searchTerm = document
            .getElementById("instructorSearchInput")
            .value.toLowerCase();
        const experienceFilter =
            document.getElementById("experienceFilter").value;

        filteredInstructors = allInstructors.filter((instructor) => {
            const matchesSearch =
                !searchTerm ||
                instructor.user_name.toLowerCase().includes(searchTerm) ||
                instructor.user_email.toLowerCase().includes(searchTerm) ||
                instructor.bio.toLowerCase().includes(searchTerm);

            let matchesExperience = true;
            if (experienceFilter) {
                const exp = parseInt(instructor.experience);
                switch (experienceFilter) {
                    case "1-3":
                        matchesExperience = exp >= 1 && exp <= 3;
                        break;
                    case "4-7":
                        matchesExperience = exp >= 4 && exp <= 7;
                        break;
                    case "8+":
                        matchesExperience = exp >= 8;
                        break;
                }
            }

            return matchesSearch && matchesExperience;
        });

        updateInstructorsList();
    }

    async function quickAddInstructor(event) {
        event.preventDefault();

        if (allInstructors.length >= 999) {
            showToast("ƒê√£ ƒë·∫°t gi·ªõi h·∫°n t·ªëi ƒëa 999 gi·∫£ng vi√™n!", "error");
            return;
        }

        const email = document.getElementById("quickInstructorEmail").value;
        const existingInstructor = allInstructors.find(
            (i) => i.user_email === email
        );

        if (existingInstructor) {
            showToast("Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!", "error");
            return;
        }

        const socialLinks = {
            github: document.getElementById("quickGithub").value,
            linkedin: document.getElementById("quickLinkedin").value,
        };

        const newInstructor = {
            id: "instructor_" + Date.now(),
            type: "instructor",
            user_name: document.getElementById("quickInstructorName").value,
            user_email: email,
            bio: document.getElementById("quickBio").value,
            experience: document.getElementById("quickExperience").value,
            avatar: document.getElementById("quickAvatar").value,
            social_links: JSON.stringify(socialLinks),
            created_at: new Date().toISOString(),
        };

        const result = await window.dataSdk.create(newInstructor);
        if (result.isOk) {
            showToast("Th√™m gi·∫£ng vi√™n th√†nh c√¥ng!", "success");
            resetInstructorForm();
            switchInstructorTab("list");
        } else {
            showToast("Th√™m gi·∫£ng vi√™n th·∫•t b·∫°i!", "error");
        }
    }

    function resetInstructorForm() {
        document.getElementById("quickInstructorForm").reset();
    }

    function updateInstructorStats() {
        const totalInstructors = allInstructors.length;
        const avgRating =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce((sum, instructor) => {
                        const courses = allCourses.filter(
                            (c) => c.instructor_id === instructor.id
                        );
                        const instructorAvgRating =
                            courses.length > 0
                                ? courses.reduce((sum, c) => sum + c.rating, 0) /
                                courses.length
                                : 0;
                        return sum + instructorAvgRating;
                    }, 0) / allInstructors.length
                ).toFixed(1)
                : 0;

        const avgCoursesPerInstructor =
            totalInstructors > 0
                ? (allCourses.length / totalInstructors).toFixed(1)
                : 0;

        const avgExperience =
            allInstructors.length > 0
                ? (
                    allInstructors.reduce(
                        (sum, i) => sum + parseInt(i.experience),
                        0
                    ) / allInstructors.length
                ).toFixed(1)
                : 0;

        document.getElementById("totalInstructors").textContent =
            totalInstructors;
        document.getElementById("avgInstructorRating").textContent = avgRating;
        document.getElementById("avgCoursesPerInstructor").textContent =
            avgCoursesPerInstructor;
        document.getElementById("avgExperience").textContent = avgExperience;

        // Detailed instructor statistics
        const instructorStatsHtml = allInstructors
            .map((instructor) => {
                const courses = allCourses.filter(
                    (c) => c.instructor_id === instructor.id
                );
                const totalStudents = courses.reduce(
                    (sum, c) => sum + c.students,
                    0
                );
                const avgRating =
                    courses.length > 0
                        ? (
                            courses.reduce((sum, c) => sum + c.rating, 0) /
                            courses.length
                        ).toFixed(1)
                        : 0;

                return `
                <div class="category-stats">
                    <h4>${instructor.avatar} ${instructor.user_name}</h4>
                    <div class="category-item">
                        <span>S·ªë kh√≥a h·ªçc:</span>
                        <span>${courses.length}</span>
                    </div>
                    <div class="category-item">
                        <span>T·ªïng h·ªçc vi√™n:</span>
                        <span>${totalStudents}</span>
                    </div>
                    <div class="category-item">
                        <span>ƒê√°nh gi√° trung b√¨nh:</span>
                        <span>${avgRating}</span>
                    </div>
                    <div class="category-item">
                        <span>Kinh nghi·ªám:</span>
                        <span>${instructor.experience} nƒÉm</span>
                    </div>
                </div>
            `;
            })
            .join("");

        document.getElementById("instructorStatsDetails").innerHTML =
            instructorStatsHtml;
    }

    // Detail view functions
    function viewCourseDetail(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        const instructor = allInstructors.find(
            (i) => i.id === course.instructor_id
        );
        const chapters = JSON.parse(course.chapters || "[]");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin-right: 20px;">
                        ${course.image}
                    </div>
                    <div>
                        <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${course.title
            }</h2>
                        <p style="color: var(--light-silver); margin: 0;">${course.category
            } ‚Ä¢ ${course.subcategory}</p>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìã M√¥ t·∫£</h4>
                    <p style="color: white; line-height: 1.6;">${course.description
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üí∞ Th√¥ng tin gi√°</h4>
                        <div style="color: white;">
                            <div>Gi√° g·ªëc: ${formatPrice(course.price)}</div>
                            ${course.discount_price
                ? `<div>Gi√° khuy·∫øn m√£i: ${formatPrice(
                    course.discount_price
                )}</div>`
                : ""
            }
                        </div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìä Th·ªëng k√™</h4>
                        <div style="color: white;">
                            <div>‚≠ê ${course.rating} (${course.reviews
            } ƒë√°nh gi√°)</div>
                            <div>üë• ${course.students} h·ªçc vi√™n</div>
                            <div>üìÖ ${new Date(
                course.created_at
            ).toLocaleDateString("vi-VN")}</div>
                        </div>
                    </div>
                </div>

                ${instructor
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üë®‚Äçüè´ Gi·∫£ng vi√™n</h4>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-right: 15px;">
                                ${instructor.avatar}
                            </div>
                            <div>
                                <div style="color: white; font-weight: bold;">${instructor.user_name}</div>
                                <div style="color: var(--light-silver);">${instructor.experience}+ nƒÉm kinh nghi·ªám</div>
                            </div>
                        </div>
                    </div>
                `
                : ""
            }

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìö Ch∆∞∆°ng tr√¨nh h·ªçc</h4>
                    <div>
                        ${chapters
                .map(
                    (chapter, index) => `
                            <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; color: white;">
                                Ch∆∞∆°ng ${index + 1}: ${chapter}
                            </div>
                        `
                )
                .join("")}
                    </div>
                </div>
            </div>
        `;

        document.getElementById("courseModalContent").innerHTML = detailHtml;
        document.getElementById("courseModalTitle").textContent = course.title;
        document.getElementById("courseModal").classList.add("show");
    }

    function viewInstructorDetail(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        const totalStudents = instructorCourses.reduce(
            (sum, c) => sum + c.students,
            0
        );
        const avgRating =
            instructorCourses.length > 0
                ? (
                    instructorCourses.reduce((sum, c) => sum + c.rating, 0) /
                    instructorCourses.length
                ).toFixed(1)
                : 0;

        const socialLinks = JSON.parse(instructor.social_links || "{}");

        const detailHtml = `
            <div style="margin-bottom: 30px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 120px; height: 120px; background: linear-gradient(45deg, var(--secondary-green), var(--accent-gold)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px;">
                        ${instructor.avatar}
                    </div>
                    <h2 style="color: var(--accent-gold); margin: 0 0 10px 0;">${instructor.user_name
            }</h2>
                    <p style="color: var(--light-silver); margin: 0;">üìß ${instructor.user_email
            }</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructorCourses.length
            }</div>
                        <div style="color: white; font-size: 0.9rem;">Kh√≥a h·ªçc</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${totalStudents}</div>
                        <div style="color: white; font-size: 0.9rem;">H·ªçc vi√™n</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${avgRating}</div>
                        <div style="color: white; font-size: 0.9rem;">ƒê√°nh gi√° TB</div>
                    </div>
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent-gold); margin-bottom: 5px;">${instructor.experience
            }</div>
                        <div style="color: white; font-size: 0.9rem;">NƒÉm KN</div>
                    </div>
                </div>

                <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìù Gi·ªõi thi·ªáu</h4>
                    <p style="color: white; line-height: 1.6;">${instructor.bio
            }</p>
                </div>

                ${Object.keys(socialLinks).length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üîó Li√™n k·∫øt</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            ${socialLinks.github
                    ? `<a href="${socialLinks.github}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">üêô GitHub</a>`
                    : ""
                }
                            ${socialLinks.linkedin
                    ? `<a href="${socialLinks.linkedin}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">üíº LinkedIn</a>`
                    : ""
                }
                            ${socialLinks.behance
                    ? `<a href="${socialLinks.behance}" target="_blank" style="color: var(--accent-gold); text-decoration: none;">üé® Behance</a>`
                    : ""
                }
                        </div>
                    </div>
                `
                : ""
            }

                ${instructorCourses.length > 0
                ? `
                    <div style="background: var(--secondary-green); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üìö Kh√≥a h·ªçc gi·∫£ng d·∫°y</h4>
                        <div>
                            ${instructorCourses
                    .map(
                        (course) => `
                                <div style="background: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: var(--accent-gold); font-weight: bold;">${course.title}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.category} ‚Ä¢ ${course.subcategory}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: white;">‚≠ê ${course.rating}</div>
                                        <div style="color: var(--light-silver); font-size: 0.9rem;">${course.students} h·ªçc vi√™n</div>
                                    </div>
                                </div>
                            `
                    )
                    .join("")}
                        </div>
                    </div>
                `
                : ""
            }
            </div>
        `;

        document.getElementById("instructorModalContent").innerHTML =
            detailHtml;
        document.getElementById("instructorModalTitle").textContent =
            instructor.user_name;
        document.getElementById("instructorModal").classList.add("show");
    }

    // Delete confirmation functions
    async function deleteCourseConfirm(courseId) {
        const course = allCourses.find((c) => c.id === courseId);
        if (!course) return;

        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√≥a h·ªçc "${course.title}"?`)) {
            const result = await window.dataSdk.delete(course);
            if (result.isOk) {
                showToast("X√≥a kh√≥a h·ªçc th√†nh c√¥ng!", "success");
            } else {
                showToast("X√≥a kh√≥a h·ªçc th·∫•t b·∫°i!", "error");
            }
        }
    }

    async function deleteInstructorConfirm(instructorId) {
        const instructor = allInstructors.find((i) => i.id === instructorId);
        if (!instructor) return;

        const instructorCourses = allCourses.filter(
            (c) => c.instructor_id === instructorId
        );
        if (instructorCourses.length > 0) {
            showToast("Kh√¥ng th·ªÉ x√≥a gi·∫£ng vi√™n ƒëang c√≥ kh√≥a h·ªçc!", "error");
            return;
        }

        if (
            confirm(
                `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a gi·∫£ng vi√™n "${instructor.user_name}"?`
            )
        ) {
            const result = await window.dataSdk.delete(instructor);
            if (result.isOk) {
                showToast("X√≥a gi·∫£ng vi√™n th√†nh c√¥ng!", "success");
            } else {
                showToast("X√≥a gi·∫£ng vi√™n th·∫•t b·∫°i!", "error");
            }
        }
    }

    // Modal functions
    function closeCourseModal() {
        document.getElementById("courseModal").classList.remove("show");
    }

    function closeInstructorModal() {
        document.getElementById("instructorModal").classList.remove("show");
    }

    // Utility functions
    function formatPrice(price) {
        return new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
        }).format(price);
    }

    function showToast(message, type = "info") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => {
            toast.classList.add("show");
        }, 100);

        setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    // Initialize app when page loads
    document.addEventListener("DOMContentLoaded", initializeApp);
</script>
<script>
    (function () {
        function c() {
            var b = a.contentDocument || a.contentWindow.document;
            if (b) {
                var d = b.createElement("script");
                d.innerHTML =
                    "window.__CF$cv$params={r:'9929e89230c5fd8b',t:'MTc2MTE0NTY5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
                b.getElementsByTagName("head")[0].appendChild(d);
            }
        }
        if (document.body) {
            var a = document.createElement("iframe");
            a.height = 1;
            a.width = 1;
            a.style.position = "absolute";
            a.style.top = 0;
            a.style.left = 0;
            a.style.border = "none";
            a.style.visibility = "hidden";
            document.body.appendChild(a);
            if ("loading" !== document.readyState) c();
            else if (window.addEventListener)
                document.addEventListener("DOMContentLoaded", c);
            else {
                var e = document.onreadystatechange || function () { };
                document.onreadystatechange = function (b) {
                    e(b);
                    "loading" !== document.readyState &&
                        ((document.onreadystatechange = e), c());
                };
            }
        }
    })();
>>>>>>> main
</script>
{{#section "styles" append=true}}
<link rel="stylesheet" href="/course-form.css" />
{{/section}}

<main class="main-content">
    <div class="container">
        <section class="section active">
            <h2 class="section-title">{{#if isEditing}}‚úèÔ∏è Edit lessons{{else}}‚ûï Add New Lesson{{/if}} for:
                {{course.CourseName}}</h2>

            {{#if error}}
            <div class="alert alert-danger" role="alert"
                style="background-color: #c0392b; color: white; border: none; margin: 0 auto 20px auto; max-width: 900px; text-align: center; font-weight: bold;">
                {{error}}
            </div>
            {{/if}}

            <div class="form-container" style="max-width: 900px; margin: 0 auto;">
                {{!-- Form POST ƒë·∫øn route add ho·∫∑c update --}}
                <form
                    action="/management/course/{{course.CourseID}}/lessons/{{#if isEditing}}{{lesson.LessonID}}/update{{else}}add{{/if}}"
                    method="POST">

                    <div class="form-row full">
                        <div class="form-group">
                            <label class="form-label" for="LessonName">Lesson name *</label>
                            {{!-- L·∫•y gi√° tr·ªã t·ª´ lesson n·∫øu ƒëang s·ª≠a, ho·∫∑c t·ª´ formData n·∫øu c√≥ l·ªói --}}
                            <input type="text" class="form-input" id="LessonName" name="LessonName"
                                value="{{#if lesson}}{{lesson.LessonName}}{{else}}{{formData.LessonName}}{{/if}}"
                                required />
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="VideoUrlInput">Video URL *</label>
                            {{!-- TH√äM ID V√ÄO INPUT --}}
                            <input type="url" class="form-input" id="VideoUrlInput" name="VideoUrl"
                                value="{{#if lesson}}{{lesson.VideoUrl}}{{else}}{{formData.VideoUrl}}{{/if}}"
                                placeholder="https://..." required />

                            {{!-- TH√äM DIV CHO UPPY --}}
                            <div id="uppy-video" style="margin-top: 15px;"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="LessonStatus">Status</label>
                            <select class="form-select" id="LessonStatus" name="LessonStatus">
                                {{! S·ª¨A L·ªñI:
                                1. B·ªè d·∫•u ()
                                2. Th√™m logic: N·∫øu kh√¥ng ph·∫£i 'isEditing', ch·ªçn 'draft' l√†m m·∫∑c ƒë·ªãnh
                                3. N·∫øu ƒëang 'isEditing', so s√°nh v·ªõi 'lesson.LessonStatus'
                                }}
                                <option value="draft" {{#if isEditing}}{{#ifCond lesson.LessonStatus '===' 'draft'
                                    }}selected{{/ifCond}}{{else}}selected{{/if}}>Draft</option>
                                <option value="published" {{#if isEditing}}{{#ifCond
                                    lesson.LessonStatus '===' 'published' }}selected{{/ifCond}}{{/if}}>Published
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="LessonPermission">View Permission</label>
                            <select class="form-select" id="LessonPermission" name="LessonPermission">
                                {{! S·ª¨A L·ªñI: T∆∞∆°ng t·ª± nh∆∞ tr√™n, m·∫∑c ƒë·ªãnh l√† 'private' }}
                                <option value="private" {{#if isEditing}}{{#ifCond
                                    lesson.LessonPermission '===' 'private'
                                    }}selected{{/ifCond}}{{else}}selected{{/if}}>Private (Registered students only)
                                </option>
                                <option value="public" {{#if isEditing}}{{#ifCond lesson.LessonPermission '===' 'public'
                                    }}selected{{/ifCond}}{{/if}}>Public (Preview)</option>
                            </select>
                        </div>
                    </div>


                    <div class="form-row full">
                        <div class="form-group">
                            <label class="form-label" for="TinyDes">Short Description (Optional)</label>
                            <textarea class="form-textarea wysiwyg-editor" id="TinyDes" name="TinyDes"
                                rows="2">{{#if lesson}}{{lesson.TinyDes}}{{else}}{{formData.TinyDes}}{{/if}}</textarea>
                        </div>
                    </div>
                    <div class="form-row full">
                        <div class="form-group">
                            <label class="form-label" for="FullDes">Full Description (Optional)</label>
                            <textarea class="form-textarea wysiwyg-editor" id="FullDes" name="FullDes"
                                rows="5">{{#if lesson}}{{lesson.FullDes}}{{else}}{{formData.FullDes}}{{/if}}</textarea>
                        </div>
                    </div>

                    <div
                        style="text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 15px;">
                        {{!-- N√∫t Quay l·∫°i --}}
                        <a href="/management/course/{{course.CourseID}}/lessons" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Back to Lesson List
                        </a>
                        {{!-- N√∫t L∆∞u/Th√™m --}}
                        <button type="submit" class="btn btn-primary">
                            {{#if isEditing}}üíæ Save Changes{{else}}‚ûï Add Lesson{{/if}}
                        </button>
                    </div>
                </form>
            </div>
        </section>
    </div>
</main>
{{#section "styles" append=true}}
<link rel="stylesheet" href="/Adminn.css">
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("roleDropdownBtn");
    const menu = document.getElementById("roleDropdownMenu");

    if (!btn || !menu) return;

    // Bấm vào nút thì bật/tắt menu
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      menu.classList.toggle("show");
    });

    // Click ra ngoài thì đóng menu
    document.addEventListener("click", (e) => {
      if (!btn.contains(e.target) && !menu.contains(e.target)) {
        menu.classList.remove("show");
      }
    });

    // Khi chọn 1 mục trong dropdown
    menu.querySelectorAll("li").forEach((item) => {
      item.addEventListener("click", () => {
        const selectedRole = item.textContent.trim();
        // 🔥 Cập nhật nội dung nút
        btn.innerHTML = `<i class="bi bi-person-badge"></i> ${selectedRole} <i class="bi bi-caret-down-fill"></i>`;
        menu.classList.remove("show");

        // (Tuỳ chọn) — lọc người dùng theo role trực tiếp
        const role = item.dataset.role;
        document.querySelectorAll(".user-table tbody tr").forEach((row) => {
          const roleText = row.querySelector(".status")?.textContent.trim().toLowerCase() || "";
          if (role === "all" || roleText.includes(selectedRole.toLowerCase())) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      });
    });
  });
</script>
{{/section}}

<div class="user-container">
  <h2>User Management</h2>

  <div class="toolbar">
    <div class="filters">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input type="text" placeholder="Search">
      </div>
      <div class="dropdown">
        <button class="btn-filter" id="roleDropdownBtn">
          <i class="bi bi-person-badge"></i> Role
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <ul class="dropdown-menu" id="roleDropdownMenu">
          <li data-role="all">All</li>
          <li data-role="0">Admin</li>
          <li data-role="1">Instructor</li>
          <li data-role="2">Student</li>
        </ul>
      </div>

    </div>
    <a href="/admin/user/add">
      <button class="btn-add"><i class="bi bi-plus-circle"></i> Add User</button>
    </a>
  </div>

  <div class="table-wrapper">
    <table class="user-table">
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Email</th>
          <th>Username</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#each users}}
        <tr>
          <td>
            <div class="user-info">
              <span>{{Fullname}}</span>
            </div>
          </td>
          <td>
            <div class="user-info">
              <span>{{Email}}</span>
            </div>
          </td>
          <td>
            <div class="user-info">
              <span>{{UserName}}</span>
            </div>
          </td>
          <td>
            <div class="user-info">
              {{#ifCond UserPermission "==" 0}}
              <span class="status admin">Admin</span>
              {{/ifCond}}
              {{#ifCond UserPermission "==" 1}}
              <span class="status teacher">Instructor</span>
              {{/ifCond}}
              {{#ifCond UserPermission "==" 2}}
              <span class="status student">Student</span>
              {{/ifCond}}
            </div>
          </td>
          <td>
            <a href="/admin/user/edit?id={{UserID}}" class="actions">
              <i class="bi bi-pencil" data-tooltip="Edit & View"></i>
            </a>
            <form action="/admin/user/del" method="POST" style="display:inline;">
              <input type="hidden" name="UserID" value="{{UserID}}">
              <button type="submit" class="actions"
                onclick="return confirm('Are you sure you want to delete this user?')">
                <i class="bi bi-trash" data-tooltip="Delete"></i>
              </button>
            </form>

          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>

</div>